<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Create a CompDb database — createCompDb • CompoundDb</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Create a CompDb database — createCompDb"><meta property="og:description" content="createCompDb creates a SQLite-based CompDb object/database
from a compound resource provided as a data.frame or tbl. Alternatively,
the name(s) of the file(s) from which the annotation should be extracted can
be provided. Supported are SDF files (such as those from the
Human Metabolome Database HMDB) that can be read using the
compound_tbl_sdf() or LipidBlast files (see compound_tbl_lipidblast().
An additional data.frame providing metadata information including the data
source, date, version and organism is mandatory.
Optionally MS/MS (MS2) spectra for compounds can be also stored in the
database. Currently only MS/MS spectra from HMDB are supported. These can
be downloaded in XML format from HMDB (http://www.hmdb.ca), loaded with
the msms_spectra_hmdb() or msms_spectra_mona() function and passed to
the function with the msms_spectra argument. See msms_spectra_hmdb() or
msms_spectra_mona() for information on the expected columns and format.
Required columns for the data.frame providing the compound information (
parameter x) are:
&quot;compound_id&quot;: the ID of the compound.
&quot;name&quot;: the compound's name.
&quot;inchi&quot;: the InChI of the compound.
&quot;inchikey&quot;: the InChI key.
&quot;formula&quot;: the chemical formula.
&quot;exactmass&quot;: the compound's (exact) mass.
&quot;synonyms&quot;: additional synonyms/aliases for the compound. Should be
either a single character or a list of values for each compound.


Any additional columns in the provided data.frame (such as e.g. &quot;smiles&quot;
providing the compound's SMILES) are also supported and will be inserted into
the database table.
See e.g. compound_tbl_sdf() or compound_tbl_lipidblast() for functions
creating such compound tables.
The table containing the MS2 spectra data should have the following format
and columns:
&quot;spectrum_id&quot;: an arbitrary ID for the spectrum. Has to be an integer.
&quot;compound_id&quot;: the ID of the compound to which the spectrum can be
associated with. This has to be present in the data.frame defining the
compounds.
&quot;polarity&quot;: the polarity (as an integer, 0 for negative, 1 for
positive, NA for not set).
&quot;collision_energy&quot;: the collision energy.
&quot;predicted&quot;: whether the spectrum was predicted or measured.
&quot;splash&quot;: the SPLASH of the spectrum.
&quot;instrument_type&quot;: the instrument type.
&quot;instrument&quot;: the name of the instrument.
&quot;precursor_mz&quot;: the precursor m/z (as a numeric).
&quot;mz&quot;: the m/z values.
&quot;intensity&quot;: the intensity values.


Only for columns &quot;spectrum_id&quot;, &quot;compound_id&quot;, &quot;mz&quot; and &quot;intensity&quot;
a value has to be provided in each row of the data.frame. The others are
optional. Note that the data.frame can be either in the format as in the
example below (i.e. each row being one spectrum and columns &quot;mz&quot; and
&quot;intensity&quot; being of type list each element being the m/z or intensity
values of one spectrum) or in a full form, in which each row represents
one peak and all columns except &quot;mz&quot; and &quot;intensity&quot; containing
redundant information of each spectrum (hence columns &quot;mz&quot; and
&quot;intensity&quot; being of type numeric).
The metadata data.frame is supposed to have two columns named &quot;name&quot; and
&quot;value&quot; providing the following minimal information as key-value pairs
(see make_metadata for a utility function to create such a data.frame):
&quot;source&quot;: the source from which the data was retrieved (e.g. &quot;HMDB&quot;).
&quot;url&quot;: the url from which the original data was retrieved.
&quot;source_version&quot;: the version from the original data source
(e.g. &quot;v4&quot;).
&quot;source_date&quot;: the date when the original data source was generated.
&quot;organism&quot;: the organism. Should be in the form &quot;Hsapiens&quot; or
&quot;Mmusculus&quot;.


createCompDbPackage creates an R data package with the data from a
CompDb object.
make_metadata helps generating a metadata data.frame in the
correct format expected by the createCompDb function. The function
returns a data.frame."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CompoundDb</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/CompoundDb-usage.html">Usage of Annotation Resources with the CompoundDb Package</a>
    </li>
    <li>
      <a href="../articles/create-compounddb.html">Creating CompoundDb annotation resources</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/EuracBiomedicalResearch/CompoundDb/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create a CompDb database</h1>
    <small class="dont-index">Source: <a href="https://github.com/EuracBiomedicalResearch/CompoundDb/blob/HEAD/R/createCompDbPackage.R" class="external-link"><code>R/createCompDbPackage.R</code></a></small>
    <div class="hidden name"><code>createCompDb.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>createCompDb</code> creates a <code>SQLite</code>-based <code><a href="CompDb.html">CompDb</a></code> object/database
from a compound resource provided as a <code>data.frame</code> or <code>tbl</code>. Alternatively,
the name(s) of the file(s) from which the annotation should be extracted can
be provided. Supported are SDF files (such as those from the
<em>Human Metabolome Database</em> HMDB) that can be read using the
<code><a href="compound_tbl_sdf.html">compound_tbl_sdf()</a></code> or LipidBlast files (see <code><a href="compound_tbl_lipidblast.html">compound_tbl_lipidblast()</a></code>.</p>
<p>An additional <code>data.frame</code> providing metadata information including the data
source, date, version and organism is mandatory.</p>
<p>Optionally MS/MS (MS2) spectra for compounds can be also stored in the
database. Currently only MS/MS spectra from HMDB are supported. These can
be downloaded in XML format from HMDB (http://www.hmdb.ca), loaded with
the <code><a href="msms_spectra_hmdb.html">msms_spectra_hmdb()</a></code> or <code><a href="msms_spectra_mona.html">msms_spectra_mona()</a></code> function and passed to
the function with the <code>msms_spectra</code> argument. See <code><a href="msms_spectra_hmdb.html">msms_spectra_hmdb()</a></code> or
<code><a href="msms_spectra_mona.html">msms_spectra_mona()</a></code> for information on the expected columns and format.</p>
<p>Required columns for the <code>data.frame</code> providing the compound information (
parameter <code>x</code>) are:</p><ul><li><p><code>"compound_id"</code>: the ID of the compound.</p></li>
<li><p><code>"name"</code>: the compound's name.</p></li>
<li><p><code>"inchi"</code>: the InChI of the compound.</p></li>
<li><p><code>"inchikey"</code>: the InChI key.</p></li>
<li><p><code>"formula"</code>: the chemical formula.</p></li>
<li><p><code>"exactmass"</code>: the compound's (exact) mass.</p></li>
<li><p><code>"synonyms"</code>: additional synonyms/aliases for the compound. Should be
either a single character or a list of values for each compound.</p></li>
</ul><p>Any additional columns in the provided <code>data.frame</code> (such as e.g. <code>"smiles"</code>
providing the compound's SMILES) are also supported and will be inserted into
the database table.</p>
<p>See e.g. <code><a href="compound_tbl_sdf.html">compound_tbl_sdf()</a></code> or <code><a href="compound_tbl_lipidblast.html">compound_tbl_lipidblast()</a></code> for functions
creating such compound tables.</p>
<p>The table containing the MS2 spectra data should have the following format
and columns:</p><ul><li><p><code>"spectrum_id"</code>: an arbitrary ID for the spectrum. Has to be an <code>integer</code>.</p></li>
<li><p><code>"compound_id"</code>: the ID of the compound to which the spectrum can be
associated with. This has to be present in the <code>data.frame</code> defining the
compounds.</p></li>
<li><p><code>"polarity"</code>: the polarity (as an <code>integer</code>, <code>0</code> for negative, <code>1</code> for
positive, <code>NA</code> for not set).</p></li>
<li><p><code>"collision_energy"</code>: the collision energy.</p></li>
<li><p><code>"predicted"</code>: whether the spectrum was predicted or measured.</p></li>
<li><p><code>"splash"</code>: the SPLASH of the spectrum.</p></li>
<li><p><code>"instrument_type"</code>: the instrument type.</p></li>
<li><p><code>"instrument"</code>: the name of the instrument.</p></li>
<li><p><code>"precursor_mz"</code>: the precursor m/z (as a <code>numeric</code>).</p></li>
<li><p><code>"mz"</code>: the m/z values.</p></li>
<li><p><code>"intensity"</code>: the intensity values.</p></li>
</ul><p>Only for columns <code>"spectrum_id"</code>, <code>"compound_id"</code>, <code>"mz"</code> and <code>"intensity"</code>
a value has to be provided in each row of the <code>data.frame</code>. The others are
optional. Note that the <code>data.frame</code> can be either in the format as in the
example below (i.e. each row being one spectrum and columns <code>"mz"</code> and
<code>"intensity"</code> being of type <code>list</code> each element being the m/z or intensity
values of one spectrum) or in a <em>full</em> form, in which each row represents
one <em>peak</em> and all columns except <code>"mz"</code> and <code>"intensity"</code> containing
redundant information of each spectrum (hence columns <code>"mz"</code> and
<code>"intensity"</code> being of type <code>numeric</code>).</p>
<p>The metadata <code>data.frame</code> is supposed to have two columns named <code>"name"</code> and
<code>"value"</code> providing the following minimal information as key-value pairs
(see <code>make_metadata</code> for a utility function to create such a <code>data.frame</code>):</p><ul><li><p><code>"source"</code>: the source from which the data was retrieved (e.g. <code>"HMDB"</code>).</p></li>
<li><p><code>"url"</code>: the url from which the original data was retrieved.</p></li>
<li><p><code>"source_version"</code>: the version from the original data source
(e.g. <code>"v4"</code>).</p></li>
<li><p><code>"source_date"</code>: the date when the original data source was generated.</p></li>
<li><p><code>"organism"</code>: the organism. Should be in the form <code>"Hsapiens"</code> or
<code>"Mmusculus"</code>.</p></li>
</ul><p><code>createCompDbPackage</code> creates an R data package with the data from a
<code><a href="CompDb.html">CompDb</a></code> object.</p>
<p><code>make_metadata</code> helps generating a metadata <code>data.frame</code> in the
correct format expected by the <code>createCompDb</code> function. The function
returns a <code>data.frame</code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">createCompDb</span><span class="op">(</span><span class="va">x</span>, <span class="va">metadata</span>, <span class="va">msms_spectra</span>, path <span class="op">=</span> <span class="st">"."</span><span class="op">)</span>

<span class="fu">createCompDbPackage</span><span class="op">(</span>
  <span class="va">x</span>,
  <span class="va">version</span>,
  <span class="va">maintainer</span>,
  <span class="va">author</span>,
  path <span class="op">=</span> <span class="st">"."</span>,
  license <span class="op">=</span> <span class="st">"Artistic-2.0"</span>
<span class="op">)</span>

<span class="fu">make_metadata</span><span class="op">(</span>
  source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,
  url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,
  source_version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,
  source_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,
  organism <span class="op">=</span> <span class="cn">NA_character_</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>For <code>createCompDb</code>: <code>data.frame</code> or <code>tbl</code> with the compound
annotations or <code>character</code> with the file name(s) from which the compound
annotations should be retrieved. See description for details.</p><div class="sourceCode"><pre><code>For `createCompDbPackage`: `character(1)` with the file name of the
`CompDb` SQLite file (created by `createCompDb`).
</code></pre></div></dd>
<dt>metadata</dt>
<dd><p>For <code>createCompDb</code>: <code>data.frame</code> with metadata
information. See description for details.</p></dd>
<dt>msms_spectra</dt>
<dd><p>For <code>createCompDb</code>: <code>data.frame</code> with MS/MS spectrum
data. See <code><a href="msms_spectra_hmdb.html">msms_spectra_hmdb()</a></code> for the expected format and a function
to import such data from spectrum xml files from HMDB.</p></dd>
<dt>path</dt>
<dd><p><code>character(1)</code> with the path to the directory where the database
file or package folder should be written. Defaults to the current
directory.</p></dd>
<dt>version</dt>
<dd><p>For <code>createCompDbPackage</code>: <code>character(1)</code> with the version
of the package (ideally in the format <code>"x.y.z"</code>).</p></dd>
<dt>maintainer</dt>
<dd><p>For <code>createCompDbPackage</code>: <code>character(1)</code> with the
name and email address of the package maintainer (in the form
<code>"First Last &lt;first.last@provider.com&gt;"</code>.</p></dd>
<dt>author</dt>
<dd><p>For <code>createCompDbPackage</code>: <code>character(1)</code> with the name
of the package author.</p></dd>
<dt>license</dt>
<dd><p>For <code>createCompDbPackage</code>: <code>character(1)</code> with the
license of the package respectively the originating provider.</p></dd>
<dt>source</dt>
<dd><p>For <code>make_metadata</code>: <code>character(1)</code> with the name of the
resource that provided the compound annotation.</p></dd>
<dt>url</dt>
<dd><p>For <code>make_metadata</code>: <code>character(1)</code> with the url to the original
resource.</p></dd>
<dt>source_version</dt>
<dd><p>For <code>make_metadata</code>: <code>character(1)</code> with the version
of the original resource providing the annotation.</p></dd>
<dt>source_date</dt>
<dd><p>For <code>make_metadata</code>: <code>character(1)</code> with the date of the
resource's release.</p></dd>
<dt>organism</dt>
<dd><p>For <code>make_metadata</code>: <code>character(1)</code> with the name of the
organism. This should be in the format <code>"Hsapiens"</code> for human,
<code>"Mmusculus"</code> for mouse etc. Leave to <code>NA</code> if not applicable.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>For <code>createCompDb</code>: a <code>character(1)</code> with the database name
(invisibly).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Metadata information is also used to create the file name for the database
file. The name starts with <code>"CompDb"</code>, followed by the organism, the
data source and its version. A compound database file for HMDB version 4
with human metabolites will thus be named: <code>"CompDb.Hsapiens.HMDB.v4"</code>.</p>
<p>A single <code>CompDb</code> database is created from multiple SDF files (e.g. for
<em>PubChem</em>) if all the file names are provided with parameter <code>x</code>. Parallel
processing is currently not enabled because SQLite does not support it yet
natively.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="compound_tbl_sdf.html">compound_tbl_sdf()</a></code> and <code><a href="compound_tbl_lipidblast.html">compound_tbl_lipidblast()</a></code> for functions
to extract compound annotations from files in SDF format, or files from
LipidBlast.</p>
<p><code><a href="import_mona_sdf.html">import_mona_sdf()</a></code> to import both the compound and spectrum data from a
SDF file from MoNa (Massbank of North America) in one call.</p>
<p><code><a href="msms_spectra_hmdb.html">msms_spectra_hmdb()</a></code> and <code><a href="msms_spectra_mona.html">msms_spectra_mona()</a></code> for functions to import
MS/MS spectrum data from xml files from HMDB or an SDF file from MoNa.</p>
<p><code><a href="CompDb.html">CompDb()</a></code> for how to use a compound database.</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Johannes Rainer</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="co">## Read compounds for a HMDB subset</span></span>
<span class="r-in"><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sdf/HMDB_sub.sdf.gz"</span>, package <span class="op">=</span> <span class="st">"CompoundDb"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">cmps</span> <span class="op">&lt;-</span> <span class="fu"><a href="compound_tbl_sdf.html">compound_tbl_sdf</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Create a metadata data.frame for the compounds.</span></span>
<span class="r-in"><span class="va">metad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"source"</span>, <span class="st">"url"</span>, <span class="st">"source_version"</span>,</span>
<span class="r-in">    <span class="st">"source_date"</span>, <span class="st">"organism"</span><span class="op">)</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HMDB"</span>, <span class="st">"http://www.hmdb.ca"</span>,</span>
<span class="r-in">    <span class="st">"v4"</span>, <span class="st">"2017-08-27"</span>, <span class="st">"Hsapiens"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Alternatively use the make_metadata helper function</span></span>
<span class="r-in"><span class="va">metad</span> <span class="op">&lt;-</span> <span class="fu">make_metadata</span><span class="op">(</span>source <span class="op">=</span> <span class="st">"HMDB"</span>, source_version <span class="op">=</span> <span class="st">"v4"</span>,</span>
<span class="r-in">    source_date <span class="op">=</span> <span class="st">"2017-08"</span>, organism <span class="op">=</span> <span class="st">"Hsapiens"</span>,</span>
<span class="r-in">    url <span class="op">=</span> <span class="st">"http://www.hmdb.ca"</span><span class="op">)</span></span>
<span class="r-in"><span class="co">## Create a SQLite database in the temporary folder</span></span>
<span class="r-in"><span class="va">db_f</span> <span class="op">&lt;-</span> <span class="fu">createCompDb</span><span class="op">(</span><span class="va">cmps</span>, metadata <span class="op">=</span> <span class="va">metad</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## The database can be loaded and accessed with a CompDb object</span></span>
<span class="r-in"><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu"><a href="CompDb.html">CompDb</a></span><span class="op">(</span><span class="va">db_f</span><span class="op">)</span></span>
<span class="r-in"><span class="va">db</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class: CompDb </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  data source: HMDB </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  version: v4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  organism: Hsapiens </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  compound count: 9 </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Create a database for HMDB that includes also MS/MS spectrum data</span></span>
<span class="r-in"><span class="va">metad2</span> <span class="op">&lt;-</span> <span class="fu">make_metadata</span><span class="op">(</span>source <span class="op">=</span> <span class="st">"HMDB_with_spectra"</span>, source_version <span class="op">=</span> <span class="st">"v4"</span>,</span>
<span class="r-in">    source_date <span class="op">=</span> <span class="st">"2017-08"</span>, organism <span class="op">=</span> <span class="st">"Hsapiens"</span>,</span>
<span class="r-in">    url <span class="op">=</span> <span class="st">"http://www.hmdb.ca"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Import spectrum information from selected MS/MS xml files from HMDB</span></span>
<span class="r-in"><span class="co">## that are provided in the package</span></span>
<span class="r-in"><span class="va">xml_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"xml"</span>, package <span class="op">=</span> <span class="st">"CompoundDb"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">spctra</span> <span class="op">&lt;-</span> <span class="fu"><a href="msms_spectra_hmdb.html">msms_spectra_hmdb</a></span><span class="op">(</span><span class="va">xml_path</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Going to process 4 xml files.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Postprocessing data ... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> OK</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Create a SQLite database in the temporary folder</span></span>
<span class="r-in"><span class="va">db_f2</span> <span class="op">&lt;-</span> <span class="fu">createCompDb</span><span class="op">(</span><span class="va">cmps</span>, metadata <span class="op">=</span> <span class="va">metad2</span>, msms_spectra <span class="op">=</span> <span class="va">spctra</span>,</span>
<span class="r-in">    path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## The database can be loaded and accessed with a CompDb object</span></span>
<span class="r-in"><span class="va">db2</span> <span class="op">&lt;-</span> <span class="fu"><a href="CompDb.html">CompDb</a></span><span class="op">(</span><span class="va">db_f2</span><span class="op">)</span></span>
<span class="r-in"><span class="va">db2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class: CompDb </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  data source: HMDB_with_spectra </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  version: v4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  organism: Hsapiens </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  compound count: 9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  MS/MS spectra count: 4 </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Does the database contain MS/MS spectrum data?</span></span>
<span class="r-in"><span class="fu"><a href="CompDb.html">hasMsMsSpectra</a></span><span class="op">(</span><span class="va">db2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Create a database for a ChEBI subset providing the file name of the</span></span>
<span class="r-in"><span class="co">## corresponding SDF file</span></span>
<span class="r-in"><span class="va">metad</span> <span class="op">&lt;-</span> <span class="fu">make_metadata</span><span class="op">(</span>source <span class="op">=</span> <span class="st">"ChEBI_sub"</span>, source_version <span class="op">=</span> <span class="st">"2"</span>,</span>
<span class="r-in">    source_date <span class="op">=</span> <span class="cn">NA</span>, organism <span class="op">=</span> <span class="st">"Hsapiens"</span>, url <span class="op">=</span> <span class="st">"www.ebi.ac.uk/chebi"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">db_f</span> <span class="op">&lt;-</span> <span class="fu">createCompDb</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sdf/ChEBI_sub.sdf.gz"</span>,</span>
<span class="r-in">    package <span class="op">=</span> <span class="st">"CompoundDb"</span><span class="op">)</span>, metadata <span class="op">=</span> <span class="va">metad</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Import data from ChEBI_sub.sdf.gz ...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> OK</span>
<span class="r-in"><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu"><a href="CompDb.html">CompDb</a></span><span class="op">(</span><span class="va">db_f</span><span class="op">)</span></span>
<span class="r-in"><span class="va">db</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class: CompDb </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  data source: ChEBI_sub </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  version: 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  organism: Hsapiens </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  compound count: 6 </span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          (-)-epicatechin</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         (1S,4R)-fenchone</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   1-alkyl-2-acylglycerol</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   16alpha-hydroxyestrone</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 2,6-dichlorobenzonitrile</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    2-hydroxybutyric acid</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                                                                                                                 inchi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                    InChI=1S/C15H14O6/c16-8-4-11(18)9-6-13(20)15(21-14(9)5-8)7-1-2-10(17)12(19)3-7/h1-5,13,15-20H,6H2/t13-,15-/m1/s1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                                                         InChI=1S/C10H16O/c1-9(2)7-4-5-10(3,6-7)8(9)11/h7H,4-6H2,1-3H3/t7-,10+/m1/s1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                                                                                                                                &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 InChI=1S/C18H22O3/c1-18-7-6-13-12-5-3-11(19)8-10(12)2-4-14(13)15(18)9-16(20)17(18)21/h3,5,8,13-16,19-20H,2,4,6-7,9H2,1H3/t13-,14-,15+,16-,18+/m1/s1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5                                                                                                     InChI=1S/C7H3Cl2N/c8-6-2-1-3-7(9)5(6)4-10/h1-3H</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6                                                                                                InChI=1S/C4H8O3/c1-2-3(5)4(6)7/h3,5H,2H2,1H3,(H,6,7)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      inchikey  formula exactmass</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 PFTAWBLQPZVEMU-UKRRQHHQSA-N C15H14O6   290.079</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 LHXDLQBQYFFVNW-XCBNKYQSSA-N  C10H16O   152.120</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                        &lt;NA&gt; C4H6O4R2   118.027</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 WPOCIZJTELRQMF-QFXBJFAPSA-N C18H22O3   286.157</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 YOYAIZYFCNQIRF-UHFFFAOYSA-N C7H3Cl2N   170.964</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 AFENDNXGAFYKQO-UHFFFAOYSA-N   C4H8O3   104.047</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                                 smiles</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                     [H][C@@]1(Oc2cc(O)cc(O)c2C[C@H]1O)c1ccc(O)c(O)c1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                      CC1(C)[C@@H]2CC[C@@](C)(C2)C1=O</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                                  OCC(CO[*])OC([*])=O</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 [H][C@]12CC[C@]3(C)C(=O)[C@H](O)C[C@@]3([H])[C@]1([H])CCc1cc(O)ccc21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5                                                    Clc1cccc(Cl)c1C#N</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6                                                         CCC(O)C(O)=O</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## connect to the database and query it's tables using RSQlite</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org" class="external-link">RSQLite</a></span><span class="op">)</span></span>
<span class="r-in"><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span><span class="fu">dbDriver</span><span class="op">(</span><span class="st">"SQLite"</span><span class="op">)</span>, <span class="va">db_f</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu">dbGetQuery</span><span class="op">(</span><span class="va">con</span>, <span class="st">"select * from metadata"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 name                    value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1             source                ChEBI_sub</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                url      www.ebi.ac.uk/chebi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     source_version                        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        source_date                     &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           organism                 Hsapiens</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   db_creation_date Mon Dec 13 10:15:29 2021</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 supporting_package               CompoundDb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  supporting_object                   CompDb</span>
<span class="r-in"><span class="fu">dbGetQuery</span><span class="op">(</span><span class="va">con</span>, <span class="st">"select * from ms_compound"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   compound_id                     name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    CHEBI:90          (-)-epicatechin</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   CHEBI:165         (1S,4R)-fenchone</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   CHEBI:598   1-alkyl-2-acylglycerol</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   CHEBI:776   16alpha-hydroxyestrone</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   CHEBI:943 2,6-dichlorobenzonitrile</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  CHEBI:1148    2-hydroxybutyric acid</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                                                                                                                 inchi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                    InChI=1S/C15H14O6/c16-8-4-11(18)9-6-13(20)15(21-14(9)5-8)7-1-2-10(17)12(19)3-7/h1-5,13,15-20H,6H2/t13-,15-/m1/s1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                                                         InChI=1S/C10H16O/c1-9(2)7-4-5-10(3,6-7)8(9)11/h7H,4-6H2,1-3H3/t7-,10+/m1/s1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                                                                                                                                &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 InChI=1S/C18H22O3/c1-18-7-6-13-12-5-3-11(19)8-10(12)2-4-14(13)15(18)9-16(20)17(18)21/h3,5,8,13-16,19-20H,2,4,6-7,9H2,1H3/t13-,14-,15+,16-,18+/m1/s1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5                                                                                                     InChI=1S/C7H3Cl2N/c8-6-2-1-3-7(9)5(6)4-10/h1-3H</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6                                                                                                InChI=1S/C4H8O3/c1-2-3(5)4(6)7/h3,5H,2H2,1H3,(H,6,7)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      inchikey  formula exactmass</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 PFTAWBLQPZVEMU-UKRRQHHQSA-N C15H14O6   290.079</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 LHXDLQBQYFFVNW-XCBNKYQSSA-N  C10H16O   152.120</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                        &lt;NA&gt; C4H6O4R2   118.027</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 WPOCIZJTELRQMF-QFXBJFAPSA-N C18H22O3   286.157</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 YOYAIZYFCNQIRF-UHFFFAOYSA-N C7H3Cl2N   170.964</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 AFENDNXGAFYKQO-UHFFFAOYSA-N   C4H8O3   104.047</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                                 smiles</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                     [H][C@@]1(Oc2cc(O)cc(O)c2C[C@H]1O)c1ccc(O)c(O)c1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                      CC1(C)[C@@H]2CC[C@@](C)(C2)C1=O</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                                  OCC(CO[*])OC([*])=O</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 [H][C@]12CC[C@]3(C)C(=O)[C@H](O)C[C@@]3([H])[C@]1([H])CCc1cc(O)ccc21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5                                                    Clc1cccc(Cl)c1C#N</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6                                                         CCC(O)C(O)=O</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## To create a CompDb R-package we could simply use the</span></span>
<span class="r-in"><span class="co">## createCompDbPackage function on the SQLite database file name.</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jan Stanstrup, Johannes Rainer, Andrea Vicini.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.9000.</p>
</div>

      </footer></div>

  


  

  </body></html>

