<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>IonDb: compound database with additional ion information — IonDb • CompoundDb</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="IonDb: compound database with additional ion information — IonDb"><meta name="description" content="IonDb objects extends CompDb by allowing to store also information about
measured ions to a CompDb() database. This information includes the type
(adduct) of the ion, it's measured (or expected) retention time for a certain
LC-MS setup and its mass-to-charge ratio.
As suggested use case, users might create (or download) a CompDb (SQLite)
database e.g. containing compound (and eventually MS/MS spectra) annotations
from public databases such as the Human Metabolome Database (HMDB) or
MassBank. To store now measured ions (e.g. of lab-internal standards) for a
certain LC-MS setup, such a CompDb can then be converted to an IonDb
using the IonDb() constructor function. Ions can be subsequently added
using the insertIon() function. In general, it is suggested to create
one IonDb database for one specific LC-MS setup. Such an IonDb
database can then be used to match experimental m/z and retention times
against ions defined in the database (using the functionality of the
MetaboAnnotation
package)."><meta property="og:description" content="IonDb objects extends CompDb by allowing to store also information about
measured ions to a CompDb() database. This information includes the type
(adduct) of the ion, it's measured (or expected) retention time for a certain
LC-MS setup and its mass-to-charge ratio.
As suggested use case, users might create (or download) a CompDb (SQLite)
database e.g. containing compound (and eventually MS/MS spectra) annotations
from public databases such as the Human Metabolome Database (HMDB) or
MassBank. To store now measured ions (e.g. of lab-internal standards) for a
certain LC-MS setup, such a CompDb can then be converted to an IonDb
using the IonDb() constructor function. Ions can be subsequently added
using the insertIon() function. In general, it is suggested to create
one IonDb database for one specific LC-MS setup. Such an IonDb
database can then be used to match experimental m/z and retention times
against ions defined in the database (using the functionality of the
MetaboAnnotation
package)."><meta property="og:image" content="https://rformassspectrometry.github.io/CompoundDb/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CompoundDb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.11.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/CompoundDb-usage.html">Usage of Annotation Resources with the CompoundDb Package</a></li>
    <li><a class="dropdown-item" href="../articles/create-compounddb.html">Creating CompoundDb annotation resources</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/CompoundDb/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>IonDb: compound database with additional ion information</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/CompoundDb/blob/main/R/IonDb.R" class="external-link"><code>R/IonDb.R</code></a>, <a href="https://github.com/RforMassSpectrometry/CompoundDb/blob/main/R/IonDb-methods.R" class="external-link"><code>R/IonDb-methods.R</code></a></small>
      <div class="d-none name"><code>IonDb.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>IonDb</code> objects extends <code>CompDb</code> by allowing to store also information about
measured ions to a <code><a href="CompDb.html">CompDb()</a></code> database. This information includes the type
(adduct) of the ion, it's measured (or expected) retention time for a certain
LC-MS setup and its mass-to-charge ratio.</p>
<p>As suggested use case, users might create (or download) a <code>CompDb</code> (SQLite)
database e.g. containing compound (and eventually MS/MS spectra) annotations
from public databases such as the Human Metabolome Database (HMDB) or
MassBank. To store now measured ions (e.g. of lab-internal standards) for a
certain LC-MS setup, such a <code>CompDb</code> can then be converted to an <code>IonDb</code>
using the <code>IonDb()</code> constructor function. Ions can be subsequently added
using the <code>insertIon()</code> function. In general, it is suggested to create
one <code>IonDb</code> database for one specific LC-MS setup. Such an <code>IonDb</code>
database can then be used to match experimental m/z and retention times
against ions defined in the database (using the functionality of the
<a href="https://rformassspectrometry.github.io/MetaboAnnotation" class="external-link">MetaboAnnotation</a>
package).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for class 'IonDb'</span></span>
<span><span class="fu">ionVariables</span><span class="op">(</span><span class="va">object</span>, includeId <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'IonDb'</span></span>
<span><span class="fu">ions</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  columns <span class="op">=</span> <span class="fu">ionVariables</span><span class="op">(</span><span class="va">object</span><span class="op">)</span>,</span>
<span>  <span class="va">filter</span>,</span>
<span>  return.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data.frame"</span>, <span class="st">"tibble"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'IonDb'</span></span>
<span><span class="fu">insertIon</span><span class="op">(</span><span class="va">object</span>, <span class="va">ions</span>, addColumns <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'IonDb'</span></span>
<span><span class="fu">deleteIon</span><span class="op">(</span><span class="va">object</span>, ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'missing,missing'</span></span>
<span><span class="fu">IonDb</span><span class="op">(</span><span class="va">x</span>, <span class="va">cdb</span>, flags <span class="op">=</span> <span class="va">SQLITE_RWC</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'CompDb,missing'</span></span>
<span><span class="fu">IonDb</span><span class="op">(</span><span class="va">x</span>, <span class="va">cdb</span>, ions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'character,missing'</span></span>
<span><span class="fu">IonDb</span><span class="op">(</span><span class="va">x</span>, <span class="va">cdb</span>, flags <span class="op">=</span> <span class="va">SQLITE_RW</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'DBIConnection,missing'</span></span>
<span><span class="fu">IonDb</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">cdb</span>,</span>
<span>  ions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  flags <span class="op">=</span> <span class="va">SQLITE_RW</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .DBNAME <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'character,CompDb'</span></span>
<span><span class="fu">IonDb</span><span class="op">(</span><span class="va">x</span>, <span class="va">cdb</span>, ions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>, flags <span class="op">=</span> <span class="va">SQLITE_RW</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'DBIConnection,CompDb'</span></span>
<span><span class="fu">IonDb</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">cdb</span>,</span>
<span>  ions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  flags <span class="op">=</span> <span class="va">SQLITE_RW</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .DBNAME <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>For all methods: a <code>IonDb</code> object.</p></dd>


<dt id="arg-includeid">includeId<a class="anchor" aria-label="anchor" href="#arg-includeid"></a></dt>
<dd><p>For <code>ionVariables()</code>: <code>logical(1)</code> whether the ion
ID (column <code>"ion_id"</code>) should be included in the result. The
default is <code>includeId = FALSE</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments. Currently not used.</p></dd>


<dt id="arg-columns">columns<a class="anchor" aria-label="anchor" href="#arg-columns"></a></dt>
<dd><p>For <code>ions()</code>: <code>character</code> with the names of the database
columns that should be retrieved. Use <code>ionVariables</code> for a list
of available column names.</p></dd>


<dt id="arg-filter">filter<a class="anchor" aria-label="anchor" href="#arg-filter"></a></dt>
<dd><p>For <code>ions()</code>: filter expression or
<code><a href="https://rdrr.io/pkg/AnnotationFilter/man/AnnotationFilter.html" class="external-link">AnnotationFilter::AnnotationFilter()</a></code> defining a filter to be used
to retrieve specific elements from the database.</p></dd>


<dt id="arg-return-type">return.type<a class="anchor" aria-label="anchor" href="#arg-return-type"></a></dt>
<dd><p>For <code>ions()</code>: either <code>"data.frame"</code> or <code>"tibble"</code> to
return the result as a <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame()</a></code> or <code><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble::tibble()</a></code>,
respectively.</p></dd>


<dt id="arg-ions">ions<a class="anchor" aria-label="anchor" href="#arg-ions"></a></dt>
<dd><p>for <code>insertIon()</code> and <code>IonDb()</code>: <code>data.frame</code> with ion
definitions to be added to the <code>IonDb</code> database. Columns <code>"compound_id"</code>
(<code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code>), <code>"ion_adduct"</code> (<code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code>), <code>"ion_mz"</code>
(<code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric()</a></code>) and <code>"ion_rt"</code> (<code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric()</a></code>) are mandatory (but, with the
exception of <code>"compound_id"</code>, can contain <code>NA</code>).</p></dd>


<dt id="arg-addcolumns">addColumns<a class="anchor" aria-label="anchor" href="#arg-addcolumns"></a></dt>
<dd><p>For <code>insertIons()</code>: <code>logical(1)</code> whether columns being
present in the submitted <code>data.frame</code> but not in the database table
should be added to the database's ion table.</p></dd>


<dt id="arg-ids">ids<a class="anchor" aria-label="anchor" href="#arg-ids"></a></dt>
<dd><p>For <code>deleteIon()</code>: <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> or (alternatively <code><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer()</a></code>)
specifying the IDs of the ions to delete. IDs in <code>ids</code> that are
not associated to any ion in the <code>IonDb</code> object are ignored.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>For <code>IonDb()</code>: database connection or <code>character(1)</code> with the file
name of the SQLite database where the <code>IonDb</code> data will be stored or a
<code><a href="CompDb.html">CompDb()</a></code> object that should be converted into an <code>IonDb</code> object.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>For all other methods<span class="sc">:</span> an <span class="st">`</span><span class="at">IonDb</span><span class="st">`</span> object.</span></code></pre><p></p></div></dd>


<dt id="arg-cdb">cdb<a class="anchor" aria-label="anchor" href="#arg-cdb"></a></dt>
<dd><p>For <code>IonDb()</code>: <code>CompDb</code> object from which data should be
transferred to the <code>IonDb</code> database.</p></dd>


<dt id="arg-flags">flags<a class="anchor" aria-label="anchor" href="#arg-flags"></a></dt>
<dd><p>For <code>IonDb()</code>: optional <code>integer(1)</code> defining the flags for
the SQLite database connection. Only used if <code>x</code> is a <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code>.</p></dd>


<dt id="arg--dbname">.DBNAME<a class="anchor" aria-label="anchor" href="#arg--dbname"></a></dt>
<dd><p><code>character(1)</code> defining the SQLite database file. This is
an internal parameter not intended to be used/provided by the user.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>See description of the respective function.</p>
    </div>
    <div class="section level2">
    <h2 id="creation-of-iondb-objects-databases">Creation of <code>IonDb</code> objects/databases<a class="anchor" aria-label="anchor" href="#creation-of-iondb-objects-databases"></a></h2>


<ul><li><p>A new <code>IonDb</code> database can be created and initialized with data from an
existing <code>CompDb</code> database by passing either the database connection
(e.g. an <code>SQLiteConnection</code>) or the file path of a (to be created) SQLite
database with parameter <code>x</code> to the <code>IonDb()</code> function and the <code>CompDb</code>
object with parameter <code>cdb</code>. Optional parameter <code>ions</code> allows insert in
addition ion definitions (which can also be added later using
<code>insertIon()</code> function calls).</p></li>
<li><p>An existing <code>CompDb</code> can be converted to an <code>IonDb</code> by passing the
<code><a href="CompDb.html">CompDb()</a></code> object with parameter <code>x</code> to the <code>IonDb</code> function. Optional
parameter <code>ions</code> allows to provide a <code>data.frame</code> with ion definitions to
be inserted in to the database (which can also be added later using
<code>insertIon()</code> function calls). Note that this fails if the database
connection for the <code>CompDb</code> is read-only.</p></li>
<li><p>Previously created <code>IonDb</code> databases can be loaded by passing either the
database connection (e.g. an <code>SQLiteConnection</code>) or the file path of the
(SQLite) database with parameter <code>x</code> to the <code>IonDb()</code> function.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="retrieve-annotations-and-ion-information-from-the-database">Retrieve annotations and ion information from the database<a class="anchor" aria-label="anchor" href="#retrieve-annotations-and-ion-information-from-the-database"></a></h2>



<p>Annotations/compound informations can be retrieved from a <code>IonDb</code> in the
same way as thay are extracted from a <code>CompDb</code>. In addition, the function
<code>ions()</code> allows to retrieve the specific ion information from the database.
It returns the actual data as a <code>data.frame</code> (if
<code>return.type = "data.frame"</code>) or a <code><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble::tibble()</a></code>
(if <code>return.type = "tibble"</code>). An <code>ions()</code> call will always
return all elements from the <em>ms_ion</em> table (unless a <code>filter</code> is used).</p>
    </div>
    <div class="section level2">
    <h2 id="general-functions-beside-those-inherited-from-compdb-">General functions (beside those inherited from <code>CompDb</code>)<a class="anchor" aria-label="anchor" href="#general-functions-beside-those-inherited-from-compdb-"></a></h2>


<ul><li><p><code>IonDb()</code>: connect to or create a compound/ion database.</p></li>
<li><p><code>ionVariables()</code>: returns all available columns/database fields for ions.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="adding-and-removing-data-from-a-database">Adding and removing data from a database<a class="anchor" aria-label="anchor" href="#adding-and-removing-data-from-a-database"></a></h2>



<p><code>IonDb</code> inherits the <code><a href="CompDb.html">insertCompound()</a></code>, <code><a href="CompDb.html">insertSpectra()</a></code>,
<code><a href="CompDb.html">deleteCompound()</a></code> and <code><a href="CompDb.html">deleteSpectra()</a></code> functions from <code><a href="CompDb.html">CompDb()</a></code>.
In addition, <code>IonDb</code> defines the functions:</p><ul><li><p><code>insertIon()</code>: adds ions to the <code>IonDb</code> object. Note that <code>insertIon()</code>
always adds all the ions specified through the <code>ions</code> parameter
and does not check if they are already in the database. To add columns
present in the submitted <code>data.frame</code> to the database table set
<code>addColumns = TRUE</code> (default is <code>addColumns = FALSE</code>).</p></li>
<li><p><code>deleteIon()</code>: deletes ions from the <code>IonDb</code> object by specifying
their IDs.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="filtering-the-database">Filtering the database<a class="anchor" aria-label="anchor" href="#filtering-the-database"></a></h2>



<p>Like <code>compounds()</code> and <code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra()</a></code> also <code>ions()</code> allows to filter the
results using specific filter classes and expressions. Filtering uses the
concepts from Bioconductor's <em>AnnotationFilter</em> package. All information
for a certain compound with the ID <code>"1"</code> can for example be
retrieved by passing the filter expression <code>filter = ~ ion_id == 1</code> to
the <code>ions()</code> function.</p>
<p>Use the <code><a href="https://rdrr.io/pkg/AnnotationFilter/man/AnnotationFilter.html" class="external-link">AnnotationFilter::supportedFilters()</a></code> function on the <code>IonDb</code>
object to get a list of all supported filters. See also examples below
or the usage vignette for details.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Andrea Vicini, Johannes Rainer</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We load a small compound test database based on MassBank which is</span></span></span>
<span class="r-in"><span><span class="co"># distributed with this package.</span></span></span>
<span class="r-in"><span><span class="va">cdb</span> <span class="op">&lt;-</span> <span class="fu"><a href="CompDb.html">CompDb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sql/CompDb.MassBank.sql"</span>, package <span class="op">=</span> <span class="st">"CompoundDb"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cdb</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class: CompDb </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  data source: MassBank </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  version: 2020.09 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  organism: NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  compound count: 70 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  MS/MS spectra count: 70 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We next want to convert this CompDb into an IonDb, but the original CompDb</span></span></span>
<span class="r-in"><span><span class="co"># database is read only, thus we have to provide the name (or connection) of</span></span></span>
<span class="r-in"><span><span class="co"># an other database to transfer all the data from the CompDb to that.</span></span></span>
<span class="r-in"><span><span class="va">idb</span> <span class="op">&lt;-</span> <span class="fu">IonDb</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/idb_ex.db"</span><span class="op">)</span>, <span class="va">cdb</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">idb</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class: IonDb </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  data source: MassBank </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  version: 2020.09 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  organism: NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  compound count: 70 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  MS/MS spectra count: 70 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ion count: 0 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># It is also possible to load a previously created IonDb passing only the</span></span></span>
<span class="r-in"><span><span class="co"># connection to the database.</span></span></span>
<span class="r-in"><span><span class="va">idb2</span> <span class="op">&lt;-</span> <span class="fu">IonDb</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/idb_ex.db"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Ion definitions can be added to the database with the `insertIon` function</span></span></span>
<span class="r-in"><span><span class="co"># providing a `data.frame` with ion definition. This `data.frame` is expected</span></span></span>
<span class="r-in"><span><span class="co"># to provide the IDs of the compounds, an adduct name/definition and the</span></span></span>
<span class="r-in"><span><span class="co"># (experimentally determined) m/z and retention time of the ion. To list</span></span></span>
<span class="r-in"><span><span class="co"># compound IDs from the CompDb database:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">compounds</span><span class="op">(</span><span class="va">cdb</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compound_id"</span>, <span class="st">"name"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   compound_id         name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           1      Mellein</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           2      Mellein</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           3      Mellein</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           4      Mellein</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           5      Mellein</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6           6 AAL toxin TB</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>compound_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"6"</span>, <span class="st">"35"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  ion_adduct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span>, <span class="st">"[M+Na]+"</span>,</span></span>
<span class="r-in"><span>                                 <span class="st">"[M+Na]+"</span>, <span class="st">"[M+2H]2+"</span>, <span class="st">"[M+H-NH3]+"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  ion_mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">179.0703</span>, <span class="fl">201.0522</span>, <span class="fl">201.0522</span>,</span></span>
<span class="r-in"><span>                             <span class="fl">201.0522</span>, <span class="fl">253.66982</span>, <span class="fl">312.0390</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  ion_rt <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Inserting ion definitions.</span></span></span>
<span class="r-in"><span><span class="va">idb</span> <span class="op">&lt;-</span> <span class="fu">insertIon</span><span class="op">(</span><span class="va">idb</span>, <span class="va">ions</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">idb</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class: IonDb </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  data source: MassBank </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  version: 2020.09 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  organism: NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  compound count: 70 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  MS/MS spectra count: 70 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ion count: 6 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">ions</span><span class="op">(</span><span class="va">idb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"formula"</span>, <span class="st">"ion_adduct"</span>, <span class="st">"ion_mz"</span>, <span class="st">"ion_rt"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ion_adduct   ion_mz ion_rt         name   formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     [M+H]+ 179.0703      1      Mellein  C10H10O3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    [M+Na]+ 201.0522      2      Mellein  C10H10O3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    [M+Na]+ 201.0522      3      Mellein  C10H10O3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    [M+Na]+ 201.0522      4      Mellein  C10H10O3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   [M+2H]2+ 253.6698      5 AAL toxin TB C25H47NO9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 [M+H-NH3]+ 312.0390      6 Aflatoxin G1  C17H12O7</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## List all available ion variables</span></span></span>
<span class="r-in"><span><span class="fu">ionVariables</span><span class="op">(</span><span class="va">idb</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "compound_id" "ion_adduct"  "ion_mz"      "ion_rt"     </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Extract a data.frame with ion variables for all ions</span></span></span>
<span class="r-in"><span><span class="fu">ions</span><span class="op">(</span><span class="va">idb</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   compound_id ion_adduct   ion_mz ion_rt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           1     [M+H]+ 179.0703      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           1    [M+Na]+ 201.0522      2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           2    [M+Na]+ 201.0522      3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           3    [M+Na]+ 201.0522      4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          35 [M+H-NH3]+ 312.0390      6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6           6   [M+2H]2+ 253.6698      5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## List all database tables and their columns</span></span></span>
<span class="r-in"><span><span class="fu"><a href="CompDb.html">tables</a></span><span class="op">(</span><span class="va">idb</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ms_compound</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "compound_id" "formula"     "exactmass"   "smiles"      "inchi"      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] "inchikey"    "cas"         "pubchem"     "name"       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ms_ion</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "ion_id"      "compound_id" "ion_adduct"  "ion_mz"      "ion_rt"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $msms_spectrum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "accession"             "spectrum_name"         "date"                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4] "authors"               "license"               "copyright"            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "publication"           "ms_level"              "polarity"             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10] "splash"                "compound_id"           "precursor_intensity"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "precursor_mz"          "adduct"                "ionization"           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16] "ionization_voltage"    "fragmentation_mode"    "collision_energy_text"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] "instrument"            "instrument_type"       "precursor_mz_text"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [22] "spectrum_id"           "collision_energy"      "predicted"            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] "msms_mz_range_min"     "msms_mz_range_max"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $msms_spectrum_peak</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "spectrum_id" "mz"          "intensity"   "peak_id"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $synonym</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "compound_id" "synonym"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Filtering the database</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">## Get all ions with an m/z between 200 and 300</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">ions</span><span class="op">(</span><span class="va">idb</span>, filter <span class="op">=</span> <span class="op">~</span> <span class="va">ion_mz</span> <span class="op">&gt;</span> <span class="fl">200</span> <span class="op">&amp;</span> <span class="va">ion_mz</span> <span class="op">&lt;</span> <span class="fl">300</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   compound_id ion_adduct   ion_mz ion_rt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           1    [M+Na]+ 201.0522      2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           2    [M+Na]+ 201.0522      3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           3    [M+Na]+ 201.0522      4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           6   [M+2H]2+ 253.6698      5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get all ions that have a H in their adduct definition.</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">ions</span><span class="op">(</span><span class="va">idb</span>, filter <span class="op">=</span> <span class="fu"><a href="Filter-classes.html">IonAdductFilter</a></span><span class="op">(</span><span class="st">"H"</span>, <span class="st">"contains"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   compound_id ion_adduct   ion_mz ion_rt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           1     [M+H]+ 179.0703      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          35 [M+H-NH3]+ 312.0390      6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           6   [M+2H]2+ 253.6698      5</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jan Stanstrup, Johannes Rainer, Roger Gine, Andrea Vicini.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

