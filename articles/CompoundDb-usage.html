<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Usage of Annotation Resources with the CompoundDb Package • CompoundDb</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Usage of Annotation Resources with the CompoundDb Package">
<meta property="og:description" content="CompoundDb">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CompoundDb</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CompoundDb-usage.html">Usage of Annotation Resources with the CompoundDb Package</a>
    </li>
    <li>
      <a href="../articles/create-compounddb.html">Creating CompoundDb annotation resources</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/EuracBiomedicalResearch/CompoundDb/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Usage of Annotation Resources with the CompoundDb Package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EuracBiomedicalResearch/CompoundDb/blob/HEAD/vignettes/CompoundDb-usage.Rmd" class="external-link"><code>vignettes/CompoundDb-usage.Rmd</code></a></small>
      <div class="hidden name"><code>CompoundDb-usage.Rmd</code></div>

    </div>

    
    
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><p><strong>Authors</strong>: Johannes Rainer and Jan Stanstrup<br><strong>Last modified:</strong> 2021-12-07 10:03:50<br><strong>Compiled</strong>: Tue Dec 7 10:36:33 2021</p>
<div class="section level1">
<h1 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h1>
<p>The <code>CompoundDb</code> package provides the functionality to create <em>compound</em> databases from a variety of sources and to use such annotation databases (<code>CompDb</code>). A detailed description on the creation of annotation resources is given in the <em>Creating CompoundDb annotation resources</em> vignette. This vignette focuses on how annotations can be search for and retrieved.</p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<p>The package (including dependencies) can be installed with the code below:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, <span class="st">"remotes"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/remote-reexports.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"stanstrup/commonMZ"</span><span class="op">)</span>
<span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"EuracBiomedicalResearch/CompoundDb"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="general-usage">General usage<a class="anchor" aria-label="anchor" href="#general-usage"></a>
</h1>
<p>In this vignette we use a small <code>CompDb</code> database containing annotations for a small number of metabolites build using <a href="https://massbank.eu/MassBank/" class="external-link">MassBank</a> release <em>2020.09</em>. The respective <code>CompDb</code> database which is loaded below contains in addition to general compound annotations also MS/MS spectra for these compounds.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EuracBiomedicalResearch/CompoundDb" class="external-link">CompoundDb</a></span><span class="op">)</span>
<span class="va">cdb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompDb.html">CompDb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sql/CompDb.MassBank.sql"</span>, package <span class="op">=</span> <span class="st">"CompoundDb"</span><span class="op">)</span><span class="op">)</span>
<span class="va">cdb</span></code></pre></div>
<pre><code><span class="co">## class: CompDb </span>
<span class="co">##  data source: MassBank </span>
<span class="co">##  version: 2020.09 </span>
<span class="co">##  organism: NA </span>
<span class="co">##  compound count: 70 </span>
<span class="co">##  MS/MS spectra count: 70</span></code></pre>
<p>General information about the database can be accessed with the <code>metadata</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Annotated-class.html" class="external-link">metadata</a></span><span class="op">(</span><span class="va">cdb</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                 name                         value</span>
<span class="co">## 1             source                      MassBank</span>
<span class="co">## 2                url https://massbank.eu/MassBank/</span>
<span class="co">## 3     source_version                       2020.09</span>
<span class="co">## 4        source_date                    1603272565</span>
<span class="co">## 5           organism                          &lt;NA&gt;</span>
<span class="co">## 6   db_creation_date      Thu Oct 22 08:45:31 2020</span>
<span class="co">## 7 supporting_package                    CompoundDb</span>
<span class="co">## 8  supporting_object                        CompDb</span></code></pre>
<div class="section level2">
<h2 id="querying-compound-annotations">Querying compound annotations<a class="anchor" aria-label="anchor" href="#querying-compound-annotations"></a>
</h2>
<p>The <code>CompoundDb</code> package is designed to provide annotation resources for small molecules, such as metabolites, that are characterized by an exact mass and additional information such as their IUPAC International Chemical Identifier <a href="https://en.wikipedia.org/wiki/International_Chemical_Identifier" class="external-link">InChI</a> or their chemical formula. The available annotations (<em>variables</em>) for compounds can differ between databases. The <code>compoundVariables</code> function can be used to retrieve a list of all available annotations for compounds.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/CompDb.html">compoundVariables</a></span><span class="op">(</span><span class="va">cdb</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "formula"   "exactmass" "smiles"    "inchi"     "inchikey"  "cas"      </span>
<span class="co">## [7] "pubchem"   "name"</span></code></pre>
<p>The actual compound annotations can then be extracted with the <code>compounds</code> function which returns by default all columns listed by <code>compoundVariables</code>. We can also define specific columns we want to extract with the <code>columns</code> parameter.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"formula"</span>, <span class="st">"exactmass"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##     formula exactmass         name</span>
<span class="co">## 1  C10H10O3  178.0630      Mellein</span>
<span class="co">## 2 C25H47NO9  505.3251 AAL toxin TB</span>
<span class="co">## 3  C17H12O6  312.0634 Aflatoxin B1</span>
<span class="co">## 4  C17H14O6  314.0790 Aflatoxin B2</span>
<span class="co">## 5  C17H12O7  328.0583 Aflatoxin G1</span>
<span class="co">## 6  C17H14O7  330.0739 Aflatoxin G2</span></code></pre>
<p>As a technical detail, <code>CompDb</code> databases follow a very simple database layout with only few constraints to allow data import and representation for a variety of sources (e.g. MassBank, HMDB, MoNa, ChEBI). For the present database, which is based on MassBank, the mapping between entries in the <em>ms_compound</em> database table and MS/MS spectra is for example 1:1 and the <em>ms_compound</em> table contains thus highly redundant information. Thus, if we would include the column <code>"compound_id"</code> in the query we would end up with redundant values instead:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compound_id"</span>, <span class="st">"name"</span>, <span class="st">"formula"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   compound_id   formula         name</span>
<span class="co">## 1           1  C10H10O3      Mellein</span>
<span class="co">## 2           2  C10H10O3      Mellein</span>
<span class="co">## 3           3  C10H10O3      Mellein</span>
<span class="co">## 4           4  C10H10O3      Mellein</span>
<span class="co">## 5           5  C10H10O3      Mellein</span>
<span class="co">## 6           6 C25H47NO9 AAL toxin TB</span></code></pre>
<p>By default, <code>compounds</code> extracts the data for <strong>all</strong> compounds stored in the database. The function supports however also <em>filters</em> to get values for specific entries only. These can be defined as <em>filter expressions</em> which are similar to the way how e.g. a <code>data.frame</code> would be subsetted in R. In the example below we</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compound_id"</span>, <span class="st">"name"</span>, <span class="st">"formula"</span><span class="op">)</span>,
          filter <span class="op">=</span> <span class="op">~</span> <span class="va">name</span> <span class="op">==</span> <span class="st">"Mellein"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   compound_id  formula    name</span>
<span class="co">## 1           1 C10H10O3 Mellein</span>
<span class="co">## 2           2 C10H10O3 Mellein</span>
<span class="co">## 3           3 C10H10O3 Mellein</span>
<span class="co">## 4           4 C10H10O3 Mellein</span>
<span class="co">## 5           5 C10H10O3 Mellein</span></code></pre>
<p>Note that a filter expression always has to start with <code>~</code> followed by the <em>variable</em> on which the data should be subsetted and the condition to select the entries of interest. The list of available filters for the <code>CompDb</code> can be retrieved with the <code>supportedFilter</code> function (more filters will be implemented in future).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/AnnotationFilter/man/AnnotationFilter.html" class="external-link">supportedFilters</a></span><span class="op">(</span><span class="va">cdb</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                 filter             field</span>
<span class="co">## 1     CompoundIdFilter       compound_id</span>
<span class="co">## 2      ExactmassFilter         exactmass</span>
<span class="co">## 3        FormulaFilter           formula</span>
<span class="co">## 4          InchiFilter             inchi</span>
<span class="co">## 5       InchikeyFilter          inchikey</span>
<span class="co">## 8 MsmsMzRangeMaxFilter msms_mz_range_max</span>
<span class="co">## 7 MsmsMzRangeMinFilter msms_mz_range_min</span>
<span class="co">## 6           NameFilter              name</span>
<span class="co">## 9     SpectrumIdFilter       spectrum_id</span></code></pre>
<p>Also, filters can be combined to create more specific filters in the same manner this would be done in R, i.e. using <code>&amp;</code> for <em>and</em>, <code>|</code> for <em>or</em> and <code>!</code> for <em>not</em>. To illustrate this we extract below all compound entries from the table for compounds with the name <em>Mellein</em> and that have a <code>"compound_id"</code> which is either 1 or 5.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compound_id"</span>, <span class="st">"name"</span>, <span class="st">"formula"</span><span class="op">)</span>,
          filter <span class="op">=</span> <span class="op">~</span> <span class="va">name</span> <span class="op">==</span> <span class="st">"Mellein"</span> <span class="op">&amp;</span> <span class="va">compound_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   compound_id  formula    name</span>
<span class="co">## 1           1 C10H10O3 Mellein</span>
<span class="co">## 2           5 C10H10O3 Mellein</span></code></pre>
<p>Similarly, we can define a filter expression to retrieve compounds with an exact mass between 310 and 320.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"exactmass"</span><span class="op">)</span>,
          filter <span class="op">=</span> <span class="op">~</span> <span class="va">exactmass</span> <span class="op">&gt;</span> <span class="fl">310</span> <span class="op">&amp;</span> <span class="va">exactmass</span> <span class="op">&lt;</span> <span class="fl">320</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   exactmass         name</span>
<span class="co">## 1  312.0634 Aflatoxin B1</span>
<span class="co">## 2  314.0790 Aflatoxin B2</span></code></pre>
<p>In addition to <em>filter expressions</em>, we can also define and combine filters using the actual filter classes. This provides additional conditions that would not be possible with regular filter expressions. Below we fetch for examples only compounds from the database that contain a <em>H14</em> in their formula. To this end we use a <code>FormulaFilter</code> with the condition <code>"contains"</code>. Note that all filters that base on character matching (i.e. <code>FormulaFilter</code>, <code>InchiFilter</code>, <code>InchikeyFilter</code>, <code>NameFilter</code>) support as conditions also <code>"contains"</code>, <code>"startsWith"</code> and <code>"endsWith"</code> in addition to <code>"="</code> and <code>"!="</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"formula"</span>, <span class="st">"exactmass"</span><span class="op">)</span>,
          filter <span class="op">=</span> <span class="fu"><a href="../reference/Filter-classes.html">FormulaFilter</a></span><span class="op">(</span><span class="st">"H14"</span>, <span class="st">"contains"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    formula exactmass         name</span>
<span class="co">## 1 C17H14O6  314.0790 Aflatoxin B2</span>
<span class="co">## 2 C17H14O7  330.0739 Aflatoxin G2</span></code></pre>
<p>It is also possible to combine filters if they are defined that way, even if it is a little less straight forward than with the filter expressions. Below we combine the <code>FormulaFilter</code> with the <code>ExactmassFilter</code> to retrieve only compounds with an <code>"H14"</code> in their formula and an exact mass between 310 and 320.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">filters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationFilter/man/AnnotationFilterList.html" class="external-link">AnnotationFilterList</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/Filter-classes.html">FormulaFilter</a></span><span class="op">(</span><span class="st">"H14"</span>, <span class="st">"contains"</span><span class="op">)</span>,
    <span class="fu"><a href="../reference/Filter-classes.html">ExactmassFilter</a></span><span class="op">(</span><span class="fl">310</span>, <span class="st">"&gt;"</span><span class="op">)</span>,
    <span class="fu"><a href="../reference/Filter-classes.html">ExactmassFilter</a></span><span class="op">(</span><span class="fl">320</span>, <span class="st">"&lt;"</span><span class="op">)</span>,
    logicOp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&amp;"</span>, <span class="st">"&amp;"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"formula"</span>, <span class="st">"exactmass"</span><span class="op">)</span>,
          filter <span class="op">=</span> <span class="va">filters</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    formula exactmass         name</span>
<span class="co">## 1 C17H14O6   314.079 Aflatoxin B2</span></code></pre>
</div>
<div class="section level2">
<h2 id="extracting-with-msms-data">Extracting with MS/MS data<a class="anchor" aria-label="anchor" href="#extracting-with-msms-data"></a>
</h2>
<p><code>CompDb</code> database can also store and provide MS/MS spectral data. These can be interfaced with a <code>Spectra</code> object from the <em><a href="https://bioconductor.org/packages/3.15/Spectra" class="external-link">Spectra</a></em> Bioconductor package which can be initialized with the <code>Spectra</code> function as shown below.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">cdb</span><span class="op">)</span>
<span class="va">sps</span></code></pre></div>
<pre><code><span class="co">## MSn data (Spectra) with 70 spectra in a MsBackendCompDb backend:</span>
<span class="co">##       msLevel     rtime scanIndex</span>
<span class="co">##     &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="co">## 1           2        NA        NA</span>
<span class="co">## 2           2        NA        NA</span>
<span class="co">## 3           2        NA        NA</span>
<span class="co">## 4           2        NA        NA</span>
<span class="co">## 5           2        NA        NA</span>
<span class="co">## ...       ...       ...       ...</span>
<span class="co">## 66          2        NA        NA</span>
<span class="co">## 67          2        NA        NA</span>
<span class="co">## 68          2        NA        NA</span>
<span class="co">## 69          2        NA        NA</span>
<span class="co">## 70          2        NA        NA</span>
<span class="co">##  ... 38 more variables/columns.</span>
<span class="co">##  data source: MassBank </span>
<span class="co">##  version: 2020.09 </span>
<span class="co">##  organism: NA</span></code></pre>
<p>With the <code>spectraVariables</code> function it is possible to list all available annotations specific to a spectrum from the database.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">sps</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1] "msLevel"                 "rtime"                  </span>
<span class="co">##  [3] "acquisitionNum"          "scanIndex"              </span>
<span class="co">##  [5] "dataStorage"             "dataOrigin"             </span>
<span class="co">##  [7] "centroided"              "smoothed"               </span>
<span class="co">##  [9] "polarity"                "precScanNum"            </span>
<span class="co">## [11] "precursorMz"             "precursorIntensity"     </span>
<span class="co">## [13] "precursorCharge"         "collisionEnergy"        </span>
<span class="co">## [15] "isolationWindowLowerMz"  "isolationWindowTargetMz"</span>
<span class="co">## [17] "isolationWindowUpperMz"  "accession"              </span>
<span class="co">## [19] "spectrum_name"           "date"                   </span>
<span class="co">## [21] "authors"                 "license"                </span>
<span class="co">## [23] "copyright"               "publication"            </span>
<span class="co">## [25] "splash"                  "compound_id"            </span>
<span class="co">## [27] "adduct"                  "ionization"             </span>
<span class="co">## [29] "ionization_voltage"      "fragmentation_mode"     </span>
<span class="co">## [31] "collision_energy_text"   "instrument"             </span>
<span class="co">## [33] "instrument_type"         "precursorMz_text"       </span>
<span class="co">## [35] "spectrum_id"             "collision_energy"       </span>
<span class="co">## [37] "predicted"               "msms_mz_range_min"      </span>
<span class="co">## [39] "msms_mz_range_max"</span></code></pre>
<p>Individual variables can then be accessed with <code>$</code> and the variable name:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sps</span><span class="op">$</span><span class="va">adduct</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "[M+H]+" "[M+H]+" "[M+H]+" "[M+H]+" "[M+H]+" "[M+H]+"</span></code></pre>
<p>For more information on how to use <code>Spectra</code> objects in your analysis have also a look at the package <a href="https://rformassspectrometry.github.io/Spectra/articles/Spectra.html" class="external-link">vignette</a> or a <a href="https://jorainer.github.io/SpectraTutorials/" class="external-link">tutorial</a> on how to perform MS/MS spectra matching with <code>Spectra</code>.</p>
<p>Similar to the <code>compounds</code> function, a call to <code>Spectra</code> will give access to <strong>all</strong> spectra in the database. Using the same filtering framework it is however also possible to <em>extract</em> only specific spectra from the database. Below we are for example accessing only the MS/MS spectra of the compound <em>Mellein</em>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mellein</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">cdb</span>, filter <span class="op">=</span> <span class="op">~</span> <span class="va">name</span> <span class="op">==</span> <span class="st">"Mellein"</span><span class="op">)</span>
<span class="va">mellein</span></code></pre></div>
<pre><code><span class="co">## MSn data (Spectra) with 5 spectra in a MsBackendCompDb backend:</span>
<span class="co">##     msLevel     rtime scanIndex</span>
<span class="co">##   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="co">## 1         2        NA        NA</span>
<span class="co">## 2         2        NA        NA</span>
<span class="co">## 3         2        NA        NA</span>
<span class="co">## 4         2        NA        NA</span>
<span class="co">## 5         2        NA        NA</span>
<span class="co">##  ... 39 more variables/columns.</span>
<span class="co">##  data source: MassBank </span>
<span class="co">##  version: 2020.09 </span>
<span class="co">##  organism: NA</span></code></pre>
<p>Instead of all spectra we extracted now only a subset of 5 spectra from the database.</p>
<p>As a simple toy example we perform next pairwise spectra comparison between the 5 spectra from <em>Mellein</em> with all the MS/MS spectra in the database.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/Spectra" class="external-link">Spectra</a></span><span class="op">)</span>
<span class="va">cormat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compareSpectra</a></span><span class="op">(</span><span class="va">mellein</span>, <span class="va">sps</span>, ppm <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h1>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jan Stanstrup, Johannes Rainer, Andrea Vicini.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
