<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Usage of Annotation Resources with the CompoundDb Package • CompoundDb</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Usage of Annotation Resources with the CompoundDb Package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CompoundDb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.9.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/CompoundDb-usage.html">Usage of Annotation Resources with the CompoundDb Package</a></li>
    <li><a class="dropdown-item" href="../articles/create-compounddb.html">Creating CompoundDb annotation resources</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/CompoundDb/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Usage of Annotation Resources with the CompoundDb Package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/CompoundDb/blob/main/vignettes/CompoundDb-usage.Rmd" class="external-link"><code>vignettes/CompoundDb-usage.Rmd</code></a></small>
      <div class="d-none name"><code>CompoundDb-usage.Rmd</code></div>
    </div>

    
    
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><p><strong>Authors</strong>: Jan Stanstrup [aut] (<a href="https://orcid.org/0000-0003-0541-7369" class="external-link uri">https://orcid.org/0000-0003-0541-7369</a>), Johannes Rainer
[aut, cre] (<a href="https://orcid.org/0000-0002-6977-7147" class="external-link uri">https://orcid.org/0000-0002-6977-7147</a>), Josep M. Badia
[ctb] (<a href="https://orcid.org/0000-0002-5704-1124" class="external-link uri">https://orcid.org/0000-0002-5704-1124</a>), Roger Gine [aut]
(<a href="https://orcid.org/0000-0003-0288-9619" class="external-link uri">https://orcid.org/0000-0003-0288-9619</a>), Andrea Vicini
[aut] (<a href="https://orcid.org/0000-0001-9438-6909" class="external-link uri">https://orcid.org/0000-0001-9438-6909</a>)<br><strong>Last modified:</strong> 2024-07-18 14:00:38.950803<br><strong>Compiled</strong>: Thu Jul 18 14:04:47 2024</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <em><a href="https://bioconductor.org/packages/3.20/CompoundDb" class="external-link">CompoundDb</a></em>
package provides the functionality to create chemical <em>compound</em>
databases from a variety of sources and to use such annotation databases
(<code>CompDb</code>) <span class="citation">(Rainer et al.
2022)</span>. A detailed description on the creation of annotation
resources is given in the <em>Creating CompoundDb annotation
resources</em> vignette. This vignette focuses on how annotations can be
search for and retrieved.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The package (including dependencies) can be installed with the code
below:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"CompoundDb"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="general-usage">General usage<a class="anchor" aria-label="anchor" href="#general-usage"></a>
</h2>
<p>In this vignette we use a small <code>CompDb</code> database
containing annotations for a small number of metabolites build using <a href="https://massbank.eu/MassBank/" class="external-link">MassBank</a> release
<em>2020.09</em>. The respective <code>CompDb</code> database which is
loaded below contains in addition to general compound annotations also
MS/MS spectra for these compounds.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/CompoundDb" class="external-link">CompoundDb</a></span><span class="op">)</span></span>
<span><span class="va">cdb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompDb.html">CompDb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sql/CompDb.MassBank.sql"</span>, package <span class="op">=</span> <span class="st">"CompoundDb"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cdb</span></span></code></pre></div>
<pre><code><span><span class="co">## class: CompDb </span></span>
<span><span class="co">##  data source: MassBank </span></span>
<span><span class="co">##  version: 2020.09 </span></span>
<span><span class="co">##  organism: NA </span></span>
<span><span class="co">##  compound count: 70 </span></span>
<span><span class="co">##  MS/MS spectra count: 70</span></span></code></pre>
<p>General information about the database can be accessed with the
<code>metadata</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Annotated-class.html" class="external-link">metadata</a></span><span class="op">(</span><span class="va">cdb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 name                         value</span></span>
<span><span class="co">## 1             source                      MassBank</span></span>
<span><span class="co">## 2                url https://massbank.eu/MassBank/</span></span>
<span><span class="co">## 3     source_version                       2020.09</span></span>
<span><span class="co">## 4        source_date                    1603272565</span></span>
<span><span class="co">## 5           organism                          &lt;NA&gt;</span></span>
<span><span class="co">## 6   db_creation_date      Thu Oct 22 08:45:31 2020</span></span>
<span><span class="co">## 7 supporting_package                    CompoundDb</span></span>
<span><span class="co">## 8  supporting_object                        CompDb</span></span></code></pre>
<div class="section level3">
<h3 id="querying-compound-annotations">Querying compound annotations<a class="anchor" aria-label="anchor" href="#querying-compound-annotations"></a>
</h3>
<p>The <code>CompoundDb</code> package is designed to provide annotation
resources for small molecules, such as metabolites, that are
characterized by an exact mass and additional information such as their
IUPAC International Chemical Identifier <a href="https://en.wikipedia.org/wiki/International_Chemical_Identifier" class="external-link">InChI</a>
or their chemical formula. The available annotations
(<em>variables</em>) for compounds can differ between databases. The
<code><a href="../reference/CompDb.html">compoundVariables()</a></code> function can be used to retrieve a list
of all available compound annotations for a specific <code>CompDb</code>
database.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/CompDb.html">compoundVariables</a></span><span class="op">(</span><span class="va">cdb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "formula"   "exactmass" "smiles"    "inchi"     "inchikey"  "cas"      </span></span>
<span><span class="co">## [7] "pubchem"   "name"</span></span></code></pre>
<p>The actual compound annotations can then be extracted with the
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds()</a></code> function which returns by default all columns
listed by <code><a href="../reference/CompDb.html">compoundVariables()</a></code>. We can also define specific
columns we want to extract with the <code>columns</code> parameter.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"formula"</span>, <span class="st">"exactmass"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     formula exactmass         name</span></span>
<span><span class="co">## 1  C10H10O3  178.0630      Mellein</span></span>
<span><span class="co">## 2 C25H47NO9  505.3251 AAL toxin TB</span></span>
<span><span class="co">## 3  C17H12O6  312.0634 Aflatoxin B1</span></span>
<span><span class="co">## 4  C17H14O6  314.0790 Aflatoxin B2</span></span>
<span><span class="co">## 5  C17H12O7  328.0583 Aflatoxin G1</span></span>
<span><span class="co">## 6  C17H14O7  330.0739 Aflatoxin G2</span></span></code></pre>
<p>As a technical detail, <code>CompDb</code> databases follow a very
simple database layout with only few constraints to allow data import
and representation for a variety of sources (e.g. MassBank, HMDB, MoNa,
ChEBI). For the present database, which is based on MassBank, the
mapping between entries in the <em>ms_compound</em> database table and
MS/MS spectra is for example 1:1 and the <em>ms_compound</em> table
contains thus highly redundant information. Thus, if we would include
the column <code>"compound_id"</code> in the query we would end up with
redundant values:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compound_id"</span>, <span class="st">"name"</span>, <span class="st">"formula"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   compound_id   formula         name</span></span>
<span><span class="co">## 1           1  C10H10O3      Mellein</span></span>
<span><span class="co">## 2           2  C10H10O3      Mellein</span></span>
<span><span class="co">## 3           3  C10H10O3      Mellein</span></span>
<span><span class="co">## 4           4  C10H10O3      Mellein</span></span>
<span><span class="co">## 5           5  C10H10O3      Mellein</span></span>
<span><span class="co">## 6           6 C25H47NO9 AAL toxin TB</span></span></code></pre>
<p>By default, <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds()</a></code> extracts the data for
<strong>all</strong> compounds stored in the database. The function
supports however also <em>filters</em> to get values for specific
entries only. These can be defined as <em>filter expressions</em> which
are similar to the way how e.g. a <code>data.frame</code> would be
subsetted in R. In the example below we extract the compound ID, name
and chemical formula for a compound <em>Mellein</em>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compound_id"</span>, <span class="st">"name"</span>, <span class="st">"formula"</span><span class="op">)</span>,</span>
<span>          filter <span class="op">=</span> <span class="op">~</span> <span class="va">name</span> <span class="op">==</span> <span class="st">"Mellein"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   compound_id  formula    name</span></span>
<span><span class="co">## 1           1 C10H10O3 Mellein</span></span>
<span><span class="co">## 2           2 C10H10O3 Mellein</span></span>
<span><span class="co">## 3           3 C10H10O3 Mellein</span></span>
<span><span class="co">## 4           4 C10H10O3 Mellein</span></span>
<span><span class="co">## 5           5 C10H10O3 Mellein</span></span></code></pre>
<p>Note that a filter expression always has to start with <code>~</code>
followed by the <em>variable</em> on which the data should be subsetted
and the condition to select the entries of interest. An overview of
available filters for a <code>CompDb</code> can be retrieved with the
<code>supportedFilter()</code> function which returns the name of the
filter and the database column on which the filter selects the
values:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationFilter/man/AnnotationFilter.html" class="external-link">supportedFilters</a></span><span class="op">(</span><span class="va">cdb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 filter             field</span></span>
<span><span class="co">## 1     CompoundIdFilter       compound_id</span></span>
<span><span class="co">## 2      ExactmassFilter         exactmass</span></span>
<span><span class="co">## 3        FormulaFilter           formula</span></span>
<span><span class="co">## 4          InchiFilter             inchi</span></span>
<span><span class="co">## 5       InchikeyFilter          inchikey</span></span>
<span><span class="co">## 8 MsmsMzRangeMaxFilter msms_mz_range_max</span></span>
<span><span class="co">## 7 MsmsMzRangeMinFilter msms_mz_range_min</span></span>
<span><span class="co">## 6           NameFilter              name</span></span>
<span><span class="co">## 9     SpectrumIdFilter       spectrum_id</span></span></code></pre>
<p>Also, filters can be combined to create more specific filters in the
same manner this would be done in R, i.e. using <code>&amp;</code> for
<em>and</em>, <code>|</code> for <em>or</em> and <code>!</code> for
<em>not</em>. To illustrate this we extract below all compound entries
from the table for compounds with the name <em>Mellein</em> and that
have a <code>"compound_id"</code> which is either 1 or 5.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compound_id"</span>, <span class="st">"name"</span>, <span class="st">"formula"</span><span class="op">)</span>,</span>
<span>          filter <span class="op">=</span> <span class="op">~</span> <span class="va">name</span> <span class="op">==</span> <span class="st">"Mellein"</span> <span class="op">&amp;</span> <span class="va">compound_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   compound_id  formula    name</span></span>
<span><span class="co">## 1           1 C10H10O3 Mellein</span></span>
<span><span class="co">## 2           5 C10H10O3 Mellein</span></span></code></pre>
<p>Similarly, we can define a filter expression to retrieve compounds
with an exact mass between 310 and 320.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"exactmass"</span><span class="op">)</span>,</span>
<span>          filter <span class="op">=</span> <span class="op">~</span> <span class="va">exactmass</span> <span class="op">&gt;</span> <span class="fl">310</span> <span class="op">&amp;</span> <span class="va">exactmass</span> <span class="op">&lt;</span> <span class="fl">320</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   exactmass         name</span></span>
<span><span class="co">## 1  312.0634 Aflatoxin B1</span></span>
<span><span class="co">## 2  314.0790 Aflatoxin B2</span></span></code></pre>
<p>In addition to <em>filter expressions</em>, we can also define and
combine filters using the actual filter classes. This provides
additional conditions that would not be possible with regular filter
expressions. Below we fetch for examples only compounds from the
database that contain a <em>H14</em> in their formula. To this end we
use a <code>FormulaFilter</code> with the condition
<code>"contains"</code>. Note that all filters that base on character
matching (i.e. <code>FormulaFilter</code>, <code>InchiFilter</code>,
<code>InchikeyFilter</code>, <code>NameFilter</code>) support as
conditions also <code>"contains"</code>, <code>"startsWith"</code> and
<code>"endsWith"</code> in addition to <code>"="</code> and
<code>"!="</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"formula"</span>, <span class="st">"exactmass"</span><span class="op">)</span>,</span>
<span>          filter <span class="op">=</span> <span class="fu"><a href="../reference/Filter-classes.html">FormulaFilter</a></span><span class="op">(</span><span class="st">"H14"</span>, <span class="st">"contains"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    formula exactmass         name</span></span>
<span><span class="co">## 1 C17H14O6  314.0790 Aflatoxin B2</span></span>
<span><span class="co">## 2 C17H14O7  330.0739 Aflatoxin G2</span></span></code></pre>
<p>It is also possible to combine filters if they are defined that way,
even if it is a little less straight forward than with the filter
expressions. Below we combine the <code>FormulaFilter</code> with the
<code>ExactmassFilter</code> to retrieve only compounds with an
<code>"H14"</code> in their formula and an exact mass between 310 and
320.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationFilter/man/AnnotationFilterList.html" class="external-link">AnnotationFilterList</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/Filter-classes.html">FormulaFilter</a></span><span class="op">(</span><span class="st">"H14"</span>, <span class="st">"contains"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/Filter-classes.html">ExactmassFilter</a></span><span class="op">(</span><span class="fl">310</span>, <span class="st">"&gt;"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/Filter-classes.html">ExactmassFilter</a></span><span class="op">(</span><span class="fl">320</span>, <span class="st">"&lt;"</span><span class="op">)</span>,</span>
<span>    logicOp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&amp;"</span>, <span class="st">"&amp;"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"formula"</span>, <span class="st">"exactmass"</span><span class="op">)</span>,</span>
<span>          filter <span class="op">=</span> <span class="va">filters</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    formula exactmass         name</span></span>
<span><span class="co">## 1 C17H14O6   314.079 Aflatoxin B2</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="additional-functionality-for-compdb-databases">Additional functionality for <code>CompDb</code> databases<a class="anchor" aria-label="anchor" href="#additional-functionality-for-compdb-databases"></a>
</h3>
<p><em>CompoundDb</em> defines additional functions to work with
<code>CompDb</code> databases. One of them is the <code><a href="../reference/CompDb.html">mass2mz()</a></code>
function that allows to directly calculate ion (adduct) m/z values for
exact (monoisotopic) masses of compounds in a database. Below we use
this function to calculate <code>[M+H]+</code> and <code>[M+Na]+</code>
ions for all unique chemical formulas in our example <code>CompDb</code>
database.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/CompDb.html">mass2mz</a></span><span class="op">(</span><span class="va">cdb</span>, adduct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              [M+H]+  [M+Na]+</span></span>
<span><span class="co">## C10H10O3   179.0703 201.0522</span></span>
<span><span class="co">## C25H47NO9  506.3324 528.3143</span></span>
<span><span class="co">## C17H12O6   313.0706 335.0526</span></span>
<span><span class="co">## C17H14O6   315.0863 337.0682</span></span>
<span><span class="co">## C17H12O7   329.0656 351.0475</span></span>
<span><span class="co">## C17H14O7   331.0812 353.0632</span></span>
<span><span class="co">## C20H20N2O3 337.1547 359.1366</span></span>
<span><span class="co">## C15H16O6   293.1020 315.0839</span></span>
<span><span class="co">## C14H10O5   259.0601 281.0420</span></span>
<span><span class="co">## C15H12O5   273.0757 295.0577</span></span>
<span><span class="co">## C16H16O8   337.0918 359.0737</span></span></code></pre>
<p>To get a <code>matrix</code> with adduct m/z values for discrete
compounds (identified by their InChIKey) we specify
<code>name = "inchikey"</code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/CompDb.html">mass2mz</a></span><span class="op">(</span><span class="va">cdb</span>, adduct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"inchikey"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                               [M+H]+  [M+Na]+</span></span>
<span><span class="co">## KWILGNNWGSNMPA-UHFFFAOYSA-N 179.0703 201.0522</span></span>
<span><span class="co">## CTXQVLLVFBNZKL-YVEDVMJTSA-N 506.3324 528.3143</span></span>
<span><span class="co">## OQIQSTLJSLGHID-WNWIJWBNSA-N 313.0706 335.0526</span></span>
<span><span class="co">## WWSYXEZEXMQWHT-WNWIJWBNSA-N 315.0863 337.0682</span></span>
<span><span class="co">## XWIYFDMXXLINPU-WNWIJWBNSA-N 329.0656 351.0475</span></span>
<span><span class="co">## WPCVRWVBBXIRMA-WNWIJWBNSA-N 331.0812 353.0632</span></span>
<span><span class="co">## MJBWDEQAUQTVKK-IAGOWNOFSA-N 329.0656 351.0475</span></span>
<span><span class="co">## SZINUGQCTHLQAZ-DQYPLSBCSA-N 337.1547 359.1366</span></span>
<span><span class="co">## MMHTXEATDNFMMY-WBIUFABUSA-N 293.1020 315.0839</span></span>
<span><span class="co">## CEBXXEKPIIDJHL-UHFFFAOYSA-N 259.0601 281.0420</span></span>
<span><span class="co">## LCSDQFNUYFTXMT-UHFFFAOYSA-N 273.0757 295.0577</span></span>
<span><span class="co">## VSMBLBOUQJNJIL-JJXSEGSLSA-N 337.0918 359.0737</span></span></code></pre>
<p>Alternatively we could also use <code>name = "compound_id"</code> to
get a value for each row in the compound database table, but for this
example database this would result in highly redundant information.</p>
<p><code><a href="../reference/CompDb.html">mass2mz()</a></code> bases on the
<code><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/mass2mz.html" class="external-link">MetaboCoreUtils::mass2mz</a></code> function and thus supports all
pre-defined adducts from that function. These are (for positive
polarity):</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">MetaboCoreUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/adductNames.html" class="external-link">adductNames</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "[M+3H]3+"          "[M+2H+Na]3+"       "[M+H+Na2]3+"      </span></span>
<span><span class="co">##  [4] "[M+Na3]3+"         "[M+2H]2+"          "[M+H+NH4]2+"      </span></span>
<span><span class="co">##  [7] "[M+H+K]2+"         "[M+H+Na]2+"        "[M+C2H3N+2H]2+"   </span></span>
<span><span class="co">## [10] "[M+2Na]2+"         "[M+C4H6N2+2H]2+"   "[M+C6H9N3+2H]2+"  </span></span>
<span><span class="co">## [13] "[M+H]+"            "[M+Li]+"           "[M+2Li-H]+"       </span></span>
<span><span class="co">## [16] "[M+NH4]+"          "[M+H2O+H]+"        "[M+Na]+"          </span></span>
<span><span class="co">## [19] "[M+CH4O+H]+"       "[M+K]+"            "[M+C2H3N+H]+"     </span></span>
<span><span class="co">## [22] "[M+2Na-H]+"        "[M+C3H8O+H]+"      "[M+C2H3N+Na]+"    </span></span>
<span><span class="co">## [25] "[M+2K-H]+"         "[M+C2H6OS+H]+"     "[M+C4H6N2+H]+"    </span></span>
<span><span class="co">## [28] "[2M+H]+"           "[2M+NH4]+"         "[2M+Na]+"         </span></span>
<span><span class="co">## [31] "[2M+K]+"           "[2M+C2H3N+H]+"     "[2M+C2H3N+Na]+"   </span></span>
<span><span class="co">## [34] "[3M+H]+"           "[M+H-NH3]+"        "[M+H-H2O]+"       </span></span>
<span><span class="co">## [37] "[M+H-Hexose-H2O]+" "[M+H-H4O2]+"       "[M+H-CH2O2]+"     </span></span>
<span><span class="co">## [40] "[M]+"</span></span></code></pre>
<p>and for negative polarity:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">MetaboCoreUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/adductNames.html" class="external-link">adductNames</a></span><span class="op">(</span>polarity <span class="op">=</span> <span class="st">"negative"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "[M-3H]3-"      "[M-2H]2-"      "[M-H]-"        "[M+Na-2H]-"   </span></span>
<span><span class="co">##  [5] "[M+Cl]-"       "[M+K-2H]-"     "[M+C2H3N-H]-"  "[M+CHO2]-"    </span></span>
<span><span class="co">##  [9] "[M+C2H3O2]-"   "[M+Br]-"       "[M+C2F3O2]-"   "[2M-H]-"      </span></span>
<span><span class="co">## [13] "[2M+CHO2]-"    "[2M+C2H3O2]-"  "[3M-H]-"       "[M-H+HCOONa]-"</span></span>
<span><span class="co">## [17] "[M]-"</span></span></code></pre>
<p>In addition, user-supplied adduct definitions are also supported (see
the help of <code><a href="../reference/CompDb.html">mass2mz()</a></code> in the <em><a href="https://bioconductor.org/packages/3.20/MetaboCoreUtils" class="external-link">MetaboCoreUtils</a></em>
package for details).</p>
</div>
<div class="section level3">
<h3 id="accessing-and-using-msms-data">Accessing and using MS/MS data<a class="anchor" aria-label="anchor" href="#accessing-and-using-msms-data"></a>
</h3>
<p><code>CompDb</code> database can also store and provide MS/MS
spectral data. These can be accessed <em>via</em> a <code>Spectra</code>
object from the <em><a href="https://bioconductor.org/packages/3.20/Spectra" class="external-link">Spectra</a></em>
Bioconductor. Such a <code>Spectra</code> object for a
<code>CompDb</code> can be created with the <code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra()</a></code>
function as in the example below.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">cdb</span><span class="op">)</span></span>
<span><span class="va">sps</span></span></code></pre></div>
<pre><code><span><span class="co">## MSn data (Spectra) with 70 spectra in a MsBackendCompDb backend:</span></span>
<span><span class="co">##       msLevel precursorMz  polarity</span></span>
<span><span class="co">##     &lt;integer&gt;   &lt;numeric&gt; &lt;integer&gt;</span></span>
<span><span class="co">## 1           2      179.07         1</span></span>
<span><span class="co">## 2           2      179.07         1</span></span>
<span><span class="co">## 3           2      179.07         1</span></span>
<span><span class="co">## 4           2      179.07         1</span></span>
<span><span class="co">## 5           2      179.07         1</span></span>
<span><span class="co">## ...       ...         ...       ...</span></span>
<span><span class="co">## 66          2     337.091         1</span></span>
<span><span class="co">## 67          2     337.091         1</span></span>
<span><span class="co">## 68          2     337.091         1</span></span>
<span><span class="co">## 69          2     337.091         1</span></span>
<span><span class="co">## 70          2     337.091         1</span></span>
<span><span class="co">##  ... 46 more variables/columns.</span></span>
<span><span class="co">##  Use  'spectraVariables' to list all of them.</span></span>
<span><span class="co">##  data source: MassBank </span></span>
<span><span class="co">##  version: 2020.09 </span></span>
<span><span class="co">##  organism: NA</span></span></code></pre>
<p>This <code>Spectra</code> object uses a <code>MsBackendCompDb</code>
to <em>represent</em> the MS data of the <code>CompDb</code> database.
In fact, only the compound identifiers and the precursor m/z values from
all spectra are stored in memory while all other data is retrieved
on-the-fly from the database when needed.</p>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables()</a></code> function lists all available
annotations for a spectrum from the database, which includes also
annotations of the associated compounds.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">sps</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "msLevel"                 "rtime"                  </span></span>
<span><span class="co">##  [3] "acquisitionNum"          "scanIndex"              </span></span>
<span><span class="co">##  [5] "dataStorage"             "dataOrigin"             </span></span>
<span><span class="co">##  [7] "centroided"              "smoothed"               </span></span>
<span><span class="co">##  [9] "polarity"                "precScanNum"            </span></span>
<span><span class="co">## [11] "precursorMz"             "precursorIntensity"     </span></span>
<span><span class="co">## [13] "precursorCharge"         "collisionEnergy"        </span></span>
<span><span class="co">## [15] "isolationWindowLowerMz"  "isolationWindowTargetMz"</span></span>
<span><span class="co">## [17] "isolationWindowUpperMz"  "compound_id"            </span></span>
<span><span class="co">## [19] "formula"                 "exactmass"              </span></span>
<span><span class="co">## [21] "smiles"                  "inchi"                  </span></span>
<span><span class="co">## [23] "inchikey"                "cas"                    </span></span>
<span><span class="co">## [25] "pubchem"                 "name"                   </span></span>
<span><span class="co">## [27] "accession"               "spectrum_name"          </span></span>
<span><span class="co">## [29] "date"                    "authors"                </span></span>
<span><span class="co">## [31] "license"                 "copyright"              </span></span>
<span><span class="co">## [33] "publication"             "splash"                 </span></span>
<span><span class="co">## [35] "adduct"                  "ionization"             </span></span>
<span><span class="co">## [37] "ionization_voltage"      "fragmentation_mode"     </span></span>
<span><span class="co">## [39] "collisionEnergy_text"    "instrument"             </span></span>
<span><span class="co">## [41] "instrument_type"         "precursorMz_text"       </span></span>
<span><span class="co">## [43] "spectrum_id"             "predicted"              </span></span>
<span><span class="co">## [45] "msms_mz_range_min"       "msms_mz_range_max"      </span></span>
<span><span class="co">## [47] "synonym"</span></span></code></pre>
<p>Individual variables can then be accessed with <code>$</code> and the
variable name:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sps</span><span class="op">$</span><span class="va">adduct</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "[M+H]+" "[M+H]+" "[M+H]+" "[M+H]+" "[M+H]+" "[M+H]+"</span></span></code></pre>
<p>For more information on how to use <code>Spectra</code> objects in
your analysis have also a look at the package <a href="https://rformassspectrometry.github.io/Spectra/articles/Spectra.html" class="external-link">vignette</a>
or a <a href="https://jorainer.github.io/SpectraTutorials/" class="external-link">tutorial</a>
on how to perform MS/MS spectra matching with <code>Spectra</code>.</p>
<p>Similar to the <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds()</a></code> function, a call to
<code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra()</a></code> will give access to <strong>all</strong> spectra
in the database. Using the same filtering framework it is however also
possible to <em>extract</em> only specific spectra from the database.
Below we are for example accessing only the MS/MS spectra of the
compound <em>Mellein</em>. Using the <code>filter</code> in the
<code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra()</a></code> call can be substantially faster than first
initializing a <code>Spectra</code> with the full data and then
subsetting that to selected spectra.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mellein</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">cdb</span>, filter <span class="op">=</span> <span class="op">~</span> <span class="va">name</span> <span class="op">==</span> <span class="st">"Mellein"</span><span class="op">)</span></span>
<span><span class="va">mellein</span></span></code></pre></div>
<pre><code><span><span class="co">## MSn data (Spectra) with 5 spectra in a MsBackendCompDb backend:</span></span>
<span><span class="co">##     msLevel precursorMz  polarity</span></span>
<span><span class="co">##   &lt;integer&gt;   &lt;numeric&gt; &lt;integer&gt;</span></span>
<span><span class="co">## 1         2      179.07         1</span></span>
<span><span class="co">## 2         2      179.07         1</span></span>
<span><span class="co">## 3         2      179.07         1</span></span>
<span><span class="co">## 4         2      179.07         1</span></span>
<span><span class="co">## 5         2      179.07         1</span></span>
<span><span class="co">##  ... 46 more variables/columns.</span></span>
<span><span class="co">##  Use  'spectraVariables' to list all of them.</span></span>
<span><span class="co">##  data source: MassBank </span></span>
<span><span class="co">##  version: 2020.09 </span></span>
<span><span class="co">##  organism: NA</span></span></code></pre>
<p>Instead of all spectra we extracted now only a subset of 5 spectra
from the database.</p>
<p>As a simple toy example we perform next pairwise spectra comparison
between the 5 spectra from <em>Mellein</em> with all the MS/MS spectra
in the database.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/Spectra" class="external-link">Spectra</a></span><span class="op">)</span></span>
<span><span class="va">cormat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compareSpectra</a></span><span class="op">(</span><span class="va">mellein</span>, <span class="va">sps</span>, ppm <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></code></pre></div>
<p>Note that the <code>MsBackendCompDb</code> does not support parallel
processing, thus, while <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compareSpectra()</a></code> would in general
support parallel processing, it gets automatically be disabled if a
<code>Spectra</code> with a <code>MsBackendCompDb</code> is used.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cormat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compareSpectra</a></span><span class="op">(</span><span class="va">mellein</span>, <span class="va">sps</span>, ppm <span class="op">=</span> <span class="fl">40</span>, BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="ion-databases">Ion databases<a class="anchor" aria-label="anchor" href="#ion-databases"></a>
</h2>
<p>The <code>CompDb</code> database layout is designed to provide
compound annotations, but in mass spectrometry (MS) ions are measured.
These ions are generated e.g. by electro spray ionization (ESI) from the
original compounds in a sample. They are characterized by their specific
mass-to-charge ratio (m/z) which is measured by the MS instrument.
Eventually, also a retention time is available. Also, for the same
compound several different ions (adducts) can be formed and measured,
all with a different m/z. This type of data can be represented by an
<code>IonDb</code> database, which extends the <code>CompDb</code> and
hence inherits all of its properties but adds additional database tables
to support also ion annotations. Also, <code>IonDb</code> objects
provide functionality to add new ion annotations to an existing
database. Thus, this type of database can be used to build lab-internal
annotation resources containing ions, m/z and retention times for pure
standards measured on a specific e.g. LC-MS setup.</p>
<p><code>CompDb</code> databases, such as the <code>cdb</code> from this
example, are however by default <em>read-only</em>, thus, we below
create a new database connection, copy the content of the
<code>cdb</code> to that database and convert the <code>CompDb</code> to
an <code>IonDb</code>.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org" class="external-link">RSQLite</a></span><span class="op">)</span></span>
<span><span class="co">## Create a temporary database</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Create an IonDb copying the content of cdb to the new database</span></span>
<span><span class="va">idb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IonDb.html">IonDb</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">cdb</span><span class="op">)</span></span>
<span><span class="va">idb</span></span></code></pre></div>
<pre><code><span><span class="co">## class: IonDb </span></span>
<span><span class="co">##  data source: MassBank </span></span>
<span><span class="co">##  version: 2020.09 </span></span>
<span><span class="co">##  organism: NA </span></span>
<span><span class="co">##  compound count: 70 </span></span>
<span><span class="co">##  MS/MS spectra count: 70 </span></span>
<span><span class="co">##  ion count: 0</span></span></code></pre>
<p>The <code>IonDb</code> defines an additional function
<code>ions</code> that allows to retrieve ion information from the
database.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/IonDb.html">ions</a></span><span class="op">(</span><span class="va">idb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] compound_id ion_adduct  ion_mz      ion_rt     </span></span>
<span><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre>
<p>The present database does not yet contain any ion information. Below
we define a data frame with ion annotations and add that to the database
with the <code><a href="../reference/IonDb.html">insertIon()</a></code> function. The column
<code>"compound_id"</code> needs to contain the identifiers of the
compounds to which the ion should be related to. In the present example
we add 2 different ions for the compound with the ID 1
(<em>Mellein</em>). Note that the specified m/z values as well as the
retention times are completely arbitrary.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>compound_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                  ion_adduct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span>,</span>
<span>                  ion_mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">123.34</span>, <span class="fl">125.34</span><span class="op">)</span>,</span>
<span>                  ion_rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">196</span>, <span class="fl">196</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">idb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IonDb.html">insertIon</a></span><span class="op">(</span><span class="va">idb</span>, <span class="va">ion</span><span class="op">)</span></span></code></pre></div>
<p>These ions have now be added to the database.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/IonDb.html">ions</a></span><span class="op">(</span><span class="va">idb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   compound_id ion_adduct ion_mz ion_rt</span></span>
<span><span class="co">## 1           1     [M+H]+ 123.34    196</span></span>
<span><span class="co">## 2           1    [M+Na]+ 125.34    196</span></span></code></pre>
<p>Ions can also be deleted from a database with the
<code>deleteIon</code> function (see the respective help page for more
information).</p>
<p>Note that we can also retrieve compound annotation information for
the ions. Below we extract the associated compound name and its exact
mass.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/IonDb.html">ions</a></span><span class="op">(</span><span class="va">idb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ion_adduct"</span>, <span class="st">"name"</span>, <span class="st">"exactmass"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   ion_adduct    name exactmass</span></span>
<span><span class="co">## 1     [M+H]+ Mellein   178.063</span></span>
<span><span class="co">## 2    [M+Na]+ Mellein   178.063</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] RSQLite_2.3.7           Spectra_1.15.4          ProtGenerics_1.37.0    </span></span>
<span><span class="co">## [4] BiocParallel_1.39.0     CompoundDb_1.9.3        S4Vectors_0.43.1       </span></span>
<span><span class="co">## [7] BiocGenerics_0.51.0     AnnotationFilter_1.29.0 BiocStyle_2.33.1       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] gtable_0.3.5            rjson_0.2.21            xfun_0.45              </span></span>
<span><span class="co">##  [4] bslib_0.7.0             ggplot2_3.5.1           htmlwidgets_1.6.4      </span></span>
<span><span class="co">##  [7] Biobase_2.65.0          generics_0.1.3          vctrs_0.6.5            </span></span>
<span><span class="co">## [10] tools_4.4.1             bitops_1.0-7            parallel_4.4.1         </span></span>
<span><span class="co">## [13] tibble_3.2.1            fansi_1.0.6             blob_1.2.4             </span></span>
<span><span class="co">## [16] cluster_2.1.6           pkgconfig_2.0.3         dbplyr_2.5.0           </span></span>
<span><span class="co">## [19] desc_1.4.3              lifecycle_1.0.4         GenomeInfoDbData_1.2.12</span></span>
<span><span class="co">## [22] compiler_4.4.1          textshaping_0.4.0       munsell_0.5.1          </span></span>
<span><span class="co">## [25] codetools_0.2-20        clue_0.3-65             GenomeInfoDb_1.41.1    </span></span>
<span><span class="co">## [28] htmltools_0.5.8.1       sass_0.4.9              RCurl_1.98-1.16        </span></span>
<span><span class="co">## [31] yaml_2.3.9              lazyeval_0.2.2          pkgdown_2.1.0.9000     </span></span>
<span><span class="co">## [34] pillar_1.9.0            jquerylib_0.1.4         MASS_7.3-61            </span></span>
<span><span class="co">## [37] DT_0.33                 cachem_1.1.0            MetaboCoreUtils_1.13.0 </span></span>
<span><span class="co">## [40] tidyselect_1.2.1        digest_0.6.36           dplyr_1.1.4            </span></span>
<span><span class="co">## [43] bookdown_0.40           rsvg_2.6.0              fastmap_1.2.0          </span></span>
<span><span class="co">## [46] grid_4.4.1              colorspace_2.1-0        cli_3.6.3              </span></span>
<span><span class="co">## [49] magrittr_2.0.3          base64enc_0.1-3         utf8_1.2.4             </span></span>
<span><span class="co">## [52] ChemmineR_3.57.0        UCSC.utils_1.1.0        scales_1.3.0           </span></span>
<span><span class="co">## [55] bit64_4.0.5             rmarkdown_2.27          XVector_0.45.0         </span></span>
<span><span class="co">## [58] httr_1.4.7              bit_4.0.5               gridExtra_2.3          </span></span>
<span><span class="co">## [61] png_0.1-8               ragg_1.3.2              memoise_2.0.1          </span></span>
<span><span class="co">## [64] evaluate_0.24.0         knitr_1.48              GenomicRanges_1.57.1   </span></span>
<span><span class="co">## [67] IRanges_2.39.1          rlang_1.1.4             Rcpp_1.0.12            </span></span>
<span><span class="co">## [70] glue_1.7.0              DBI_1.2.3               xml2_1.3.6             </span></span>
<span><span class="co">## [73] BiocManager_1.30.23     jsonlite_1.8.8          R6_2.5.1               </span></span>
<span><span class="co">## [76] MsCoreUtils_1.17.0      systemfonts_1.1.0       fs_1.6.4               </span></span>
<span><span class="co">## [79] zlibbioc_1.51.1</span></span></code></pre>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-rainer_modular_2022" class="csl-entry">
Rainer, Johannes, Andrea Vicini, Liesa Salzer, Jan Stanstrup, Josep M.
Badia, Steffen Neumann, Michael A. Stravs, et al. 2022. <span>“A
<span>Modular</span> and <span>Expandable</span> <span>Ecosystem</span>
for <span>Metabolomics</span> <span>Data</span> <span>Annotation</span>
in <span>R</span>.”</span> <em>Metabolites</em> 12 (2): 173. <a href="https://doi.org/10.3390/metabo12020173" class="external-link">https://doi.org/10.3390/metabo12020173</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jan Stanstrup, Johannes Rainer, Roger Gine, Andrea Vicini.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
