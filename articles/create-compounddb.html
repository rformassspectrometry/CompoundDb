<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating CompoundDb annotation resources • CompoundDb</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating CompoundDb annotation resources">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CompoundDb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.9.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/CompoundDb-usage.html">Usage of Annotation Resources with the CompoundDb Package</a></li>
    <li><a class="dropdown-item" href="../articles/create-compounddb.html">Creating CompoundDb annotation resources</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/CompoundDb/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Creating CompoundDb annotation resources</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/CompoundDb/blob/main/vignettes/create-compounddb.Rmd" class="external-link"><code>vignettes/create-compounddb.Rmd</code></a></small>
      <div class="d-none name"><code>create-compounddb.Rmd</code></div>
    </div>

    
    
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><p><strong>Authors</strong>: Johannes Rainer<br><strong>Modified</strong>: 2024-07-18 14:00:38.950803<br><strong>Compiled</strong>: Thu Jul 18 14:04:57 2024</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Chemical compound annotation and information can be retrieved from a
variety of sources including <a href="http://www.hmdb.ca" class="external-link">HMDB</a>, <a href="http://www.lipidmaps.org" class="external-link">LipidMaps</a> or <a href="https://www.ebi.ac.uk/chebi" class="external-link">ChEBI</a>. The <em><a href="https://bioconductor.org/packages/3.20/CompoundDb" class="external-link">CompoundDb</a></em>
package provides functionality to extract data relevant for
(chromatographic) peak annotations in metabolomics/lipidomics
experiments from these sources and to store it into a common format
(i.e. an <code>CompDb</code> object/database). This vignette describes
how such <code>CompDb</code> objects can be created exemplified with
package-internal test files that represent data subsets from some
annotation resources.</p>
<p>The R object to represent the compound annotation is the
<code>CompDb</code> object. Each object (respectively its database) is
supposed to contain and provide annotations from a single source
(e.g. HMDB or LipidMaps) but it is also possible to create cross-source
databases too.</p>
</div>
<div class="section level2">
<h2 id="creating-compdb-databases">Creating <code>CompDb</code> databases<a class="anchor" aria-label="anchor" href="#creating-compdb-databases"></a>
</h2>
<p><code>CompDb</code> databases can be created from existing data
resources such as the Human Metabolome Database (HMDB) by importing all
of their data or can alternatively be <em>build</em> by sequentially
adding data and information to the database. This section explains first
how data can be loaded from existing resources to create a
<code>CompDb</code> database and in the last subsection how an empty
<code>CompDb</code> can be sequentially and manually filled with
annotation data @ref(sec:fill).</p>
<p>The <em>CompoundDb</em> package provides the
<code><a href="../reference/compound_tbl_sdf.html">compound_tbl_sdf()</a></code> and the
<code><a href="../reference/compound_tbl_lipidblast.html">compound_tbl_lipidblast()</a></code> functions to extract relevant
compound annotation from files in SDF (structure-data file) format or in
the json files from LipidBlast (<a href="http://mona.fiehnlab.ucdavis.edu/downloads" class="external-link uri">http://mona.fiehnlab.ucdavis.edu/downloads</a>).
<em>CompoundDb</em> allows to process SDF files from:</p>
<ul>
<li>Human Metabolome Database (HMDB), <a href="http://www.hmdb.ca" class="external-link uri">http://www.hmdb.ca</a>
</li>
<li>Chemical Entities of Biological Interest (ChEBI): <a href="https://www.ebi.ac.uk/chebi" class="external-link uri">https://www.ebi.ac.uk/chebi</a>
</li>
<li>LIPID MAPS Structure Database (LMSD): <a href="http://www.lipidmaps.org" class="external-link uri">http://www.lipidmaps.org</a>
</li>
<li>PubChem: <a href="https://pubchem.ncbi.nlm.nih.gov" class="external-link uri">https://pubchem.ncbi.nlm.nih.gov</a>
</li>
<li>MoNa (Massbank of North America): <a href="http://mona.fiehnlab.ucdavis.edu" class="external-link uri">http://mona.fiehnlab.ucdavis.edu</a> (for MoNa import see
the next section).</li>
</ul>
<p>Note however that it is also possible to define such a table manually
and use that to create the database. As simple example for this is
provided in the section <em><code>CompDb</code> from custom input</em>
@ref(sec:custom) below or the help page of <code><a href="../reference/createCompDb.html">createCompDb()</a></code>
for more details on that.</p>
<div class="section level3">
<h3 id="compdb-from-hmdb-data">
<code>CompDb</code> from HMDB data<a class="anchor" aria-label="anchor" href="#compdb-from-hmdb-data"></a>
</h3>
<p>Below we use the <code><a href="../reference/compound_tbl_sdf.html">compound_tbl_sdf()</a></code> to extract compound
annotations from a SDF file representing a very small subset of the HMDB
database. To generate a database for the full HMDB we would have to
download the <em>structures.sdf</em> file containing all metabolites and
load that file instead.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/CompoundDb" class="external-link">CompoundDb</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Locate the file</span></span>
<span><span class="va">hmdb_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sdf/HMDB_sub.sdf.gz"</span>, package <span class="op">=</span> <span class="st">"CompoundDb"</span><span class="op">)</span></span>
<span><span class="co">## Extract the data</span></span>
<span><span class="va">cmps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compound_tbl_sdf.html">compound_tbl_sdf</a></span><span class="op">(</span><span class="va">hmdb_file</span><span class="op">)</span></span></code></pre></div>
<p>The function returns by default a
(<code>data.frame</code>-equivalent) <code>tibble</code> (from the
<em>tidyverse</em>’s <em>tibble</em> package).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmps</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 8</span></span></span>
<span><span class="co">##   compound_id name              inchi inchikey formula exactmass synonyms smiles</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;named &gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> HMDB0000001 1-Methylhistidine InCh… BRMWTNU… C7H11N…     169.  <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">"</span>CN1C…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> HMDB0000002 1,3-Diaminopropa… InCh… XFNJVJP… C3H10N2      74.1 <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">"</span>NCCC…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> HMDB0000005 2-Ketobutyric ac… InCh… TYEYBOS… C4H6O3      102.  <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">"</span>CCC(…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> HMDB0000008 2-Hydroxybutyric… InCh… AFENDNX… C4H8O3      104.  <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">"</span>CCC(…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> HMDB0000010 2-Methoxyestrone  InCh… WHEUWNK… C19H24…     300.  <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">"</span>[H][…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> HMDB0000011 (R)-3-Hydroxybut… InCh… WHBMMWS… C4H8O3      104.  <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">"</span>C[C@…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> HMDB0000012 Deoxyuridine      InCh… MXHRCPN… C9H12N…     228.  <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">"</span>OC[C…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> HMDB0004370 N-Methyltryptami… InCh… NCIKQJB… C11H14…     174.  <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">"</span>CNCC…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span> HMDB0006719 5,6-trans-Vitami… InCh… QYSXJUF… C27H44O     384.  <span style="color: #949494;">&lt;chr&gt;</span>    <span style="color: #949494;">"</span>CC(C…</span></span></code></pre>
<p>The <code>tibble</code> contains columns</p>
<ul>
<li>
<code>compound_id</code>: the resource-specific ID of the compound.
Can be an <code>integer</code> or a <code>character</code>.</li>
<li>
<code>name</code>: the name of the compound, mostly a generic or
common name.</li>
<li>
<code>inchi</code>: the compound’s inchi.</li>
<li>
<code>inchikey</code>: the INCHI key.</li>
<li>
<code>formula</code>: the chemical formula of the compound.</li>
<li>
<code>exactmass</code>: the compounds (monoisotopic) mass.</li>
<li>
<code>synonyms</code>: a <code>list</code> of aliases/synonyms for
the compound.</li>
<li>
<code>smiles</code>: the SMILES of the compound.</li>
</ul>
<p>To create a simple compound database, we could pass this
<code>tibble</code> along with additional required metadata information
to the <code><a href="../reference/createCompDb.html">createCompDb()</a></code> function. In the present example we
want to add however also MS/MS spectrum data to the database. We thus
load below the MS/MS spectra for some of the compounds from the
respective xml files downloaded from HMDB. To this end we pass the path
to the folder in which the files are located to the
<code><a href="../reference/msms_spectra_hmdb.html">msms_spectra_hmdb()</a></code> function. The function identifies the
xml files containing MS/MS spectra based on their their file name and
loads the respective spectrum data. The folder can therefore also
contain other files, but the xml files from HMDB should not be renamed
or the function will not recognice them. Note also that at present only
MS/MS spectrum xml files from HMDB are supported (one xml file per
spectrum); these could be downloaded from HMDB with the
<em>hmdb_all_spectra.zip</em> file.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Locate the folder with the xml files</span></span>
<span><span class="va">xml_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"xml"</span>, package <span class="op">=</span> <span class="st">"CompoundDb"</span><span class="op">)</span></span>
<span><span class="va">spctra</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msms_spectra_hmdb.html">msms_spectra_hmdb</a></span><span class="op">(</span><span class="va">xml_path</span><span class="op">)</span></span></code></pre></div>
<p>Also here, spectra information can be manually provided by adhering
to the expected structure of the <code>data.frame</code> (see
<code><a href="../reference/createCompDb.html">?createCompDb</a></code> for details).</p>
<p>At last we have to create the metadata for the resource. The metadata
information for a <code>CompDb</code> resource is crucial as it defines
the origin of the annotations and its version. This information should
thus be carefully defined by the user. Below we use the
<code><a href="../reference/createCompDb.html">make_metadata()</a></code> helper function to create a
<code>data.frame</code> in the expected format. The organism should be
provided in the format e.g. <code>"Hsapiens"</code> for human or
<code>"Mmusculus"</code> for mouse, i.e. capital first letter followed
by lower case characters without whitespaces.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCompDb.html">make_metadata</a></span><span class="op">(</span>source <span class="op">=</span> <span class="st">"HMDB"</span>, url <span class="op">=</span> <span class="st">"http://www.hmdb.ca"</span>,</span>
<span>                       source_version <span class="op">=</span> <span class="st">"4.0"</span>, source_date <span class="op">=</span> <span class="st">"2017-09"</span>,</span>
<span>                       organism <span class="op">=</span> <span class="st">"Hsapiens"</span><span class="op">)</span></span></code></pre></div>
<p>With all the required data ready we create the SQLite database for
the HMDB subset. With <code>path</code> we specify the path to the
directory in which we want to save the database. This defaults to the
current working directory, but for this example we save the database
into a temporary folder.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCompDb.html">createCompDb</a></span><span class="op">(</span><span class="va">cmps</span>, metadata <span class="op">=</span> <span class="va">metad</span>, msms_spectra <span class="op">=</span> <span class="va">spctra</span>,</span>
<span>                        path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The variable <code>db_file</code> is now the file name of the SQLite
database. We can pass this file name to the <code><a href="../reference/CompDb.html">CompDb()</a></code>
function to get the <code>CompDb</code> objects acting as the interface
to the database.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmpdb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompDb.html">CompDb</a></span><span class="op">(</span><span class="va">db_file</span><span class="op">)</span></span>
<span><span class="va">cmpdb</span></span></code></pre></div>
<pre><code><span><span class="co">## class: CompDb </span></span>
<span><span class="co">##  data source: HMDB </span></span>
<span><span class="co">##  version: 4.0 </span></span>
<span><span class="co">##  organism: Hsapiens </span></span>
<span><span class="co">##  compound count: 9 </span></span>
<span><span class="co">##  MS/MS spectra count: 4</span></span></code></pre>
<p>To extract all compounds from the database we can use the
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds()</a></code> function. The parameter <code>columns</code>
allows to choose the database columns to return. Any columns for any of
the database tables are supported. To get an overview of available
database tables and their columns, the <code><a href="../reference/CompDb.html">tables()</a></code> function
can be used:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/CompDb.html">tables</a></span><span class="op">(</span><span class="va">cmpdb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $ms_compound</span></span>
<span><span class="co">## [1] "compound_id" "name"        "inchi"       "inchikey"    "formula"    </span></span>
<span><span class="co">## [6] "exactmass"   "smiles"     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $msms_spectrum</span></span>
<span><span class="co">##  [1] "original_spectrum_id" "compound_id"          "polarity"            </span></span>
<span><span class="co">##  [4] "collision_energy"     "predicted"            "splash"              </span></span>
<span><span class="co">##  [7] "instrument_type"      "instrument"           "precursor_mz"        </span></span>
<span><span class="co">## [10] "spectrum_id"          "msms_mz_range_min"    "msms_mz_range_max"   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $msms_spectrum_peak</span></span>
<span><span class="co">## [1] "spectrum_id" "mz"          "intensity"   "peak_id"    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $synonym</span></span>
<span><span class="co">## [1] "compound_id" "synonym"</span></span></code></pre>
<p>Below we extract only selected columns from the <em>compounds</em>
table.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cmpdb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"formula"</span>, <span class="st">"exactmass"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                        name   formula exactmass</span></span>
<span><span class="co">## 1 (R)-3-Hydroxybutyric acid    C4H8O3  104.0473</span></span>
<span><span class="co">## 2        1,3-Diaminopropane   C3H10N2   74.0844</span></span>
<span><span class="co">## 3         1-Methylhistidine C7H11N3O2  169.0851</span></span>
<span><span class="co">## 4     2-Hydroxybutyric acid    C4H8O3  104.0473</span></span>
<span><span class="co">## 5        2-Ketobutyric acid    C4H6O3  102.0317</span></span>
<span><span class="co">## 6          2-Methoxyestrone  C19H24O3  300.1725</span></span>
<span><span class="co">## 7      5,6-trans-Vitamin D3   C27H44O  384.3392</span></span>
<span><span class="co">## 8              Deoxyuridine C9H12N2O5  228.0746</span></span>
<span><span class="co">## 9        N-Methyltryptamine  C11H14N2  174.1157</span></span></code></pre>
<p>Analogously we can use the <code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra()</a></code> function to extract
spectrum data from the database. The function returns by default a
<code>Spectra</code> object from the <em><a href="https://bioconductor.org/packages/3.20/Spectra" class="external-link">Spectra</a></em>
package with all spectra metadata available as <em>spectra
variables</em>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/Spectra" class="external-link">Spectra</a></span><span class="op">)</span></span>
<span><span class="va">sps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">cmpdb</span><span class="op">)</span></span>
<span><span class="va">sps</span></span></code></pre></div>
<pre><code><span><span class="co">## MSn data (Spectra) with 4 spectra in a MsBackendCompDb backend:</span></span>
<span><span class="co">##     msLevel precursorMz  polarity</span></span>
<span><span class="co">##   &lt;integer&gt;   &lt;numeric&gt; &lt;integer&gt;</span></span>
<span><span class="co">## 1        NA          NA         1</span></span>
<span><span class="co">## 2        NA          NA         1</span></span>
<span><span class="co">## 3        NA          NA         1</span></span>
<span><span class="co">## 4        NA          NA         0</span></span>
<span><span class="co">##  ... 32 more variables/columns.</span></span>
<span><span class="co">##  Use  'spectraVariables' to list all of them.</span></span>
<span><span class="co">##  data source: HMDB </span></span>
<span><span class="co">##  version: 4.0 </span></span>
<span><span class="co">##  organism: Hsapiens</span></span></code></pre>
<p>The available <em>spectra variables</em> for the <code>Spectra</code>
object can be retrieved with <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables()</a></code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">sps</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "msLevel"                 "rtime"                  </span></span>
<span><span class="co">##  [3] "acquisitionNum"          "scanIndex"              </span></span>
<span><span class="co">##  [5] "dataStorage"             "dataOrigin"             </span></span>
<span><span class="co">##  [7] "centroided"              "smoothed"               </span></span>
<span><span class="co">##  [9] "polarity"                "precScanNum"            </span></span>
<span><span class="co">## [11] "precursorMz"             "precursorIntensity"     </span></span>
<span><span class="co">## [13] "precursorCharge"         "collisionEnergy"        </span></span>
<span><span class="co">## [15] "isolationWindowLowerMz"  "isolationWindowTargetMz"</span></span>
<span><span class="co">## [17] "isolationWindowUpperMz"  "compound_id"            </span></span>
<span><span class="co">## [19] "name"                    "inchi"                  </span></span>
<span><span class="co">## [21] "inchikey"                "formula"                </span></span>
<span><span class="co">## [23] "exactmass"               "smiles"                 </span></span>
<span><span class="co">## [25] "original_spectrum_id"    "predicted"              </span></span>
<span><span class="co">## [27] "splash"                  "instrument_type"        </span></span>
<span><span class="co">## [29] "instrument"              "spectrum_id"            </span></span>
<span><span class="co">## [31] "msms_mz_range_min"       "msms_mz_range_max"      </span></span>
<span><span class="co">## [33] "synonym"</span></span></code></pre>
<p>Individual spectra variables can be accessed with the <code>$</code>
operator:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sps</span><span class="op">$</span><span class="va">collisionEnergy</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 10 25 NA 20</span></span></code></pre>
<p>And the actual m/z and intensity values with <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz()</a></code> and
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity()</a></code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz</a></span><span class="op">(</span><span class="va">sps</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NumericList of length 4</span></span>
<span><span class="co">## [[1]] 109.2 124.2 124.5 170.16 170.52</span></span>
<span><span class="co">## [[2]] 83.1 96.12 97.14 109.14 124.08 125.1 170.16</span></span>
<span><span class="co">## [[3]] 44.1 57.9 61.4 71.2 73.8 78.3 78.8 ... 142.9 144.1 157.6 158 175.2 193.2</span></span>
<span><span class="co">## [[4]] 111.0815386 249.2587746 273.2587746 ... 367.3006394 383.3319396</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## m/z of the 2nd spectrum</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz</a></span><span class="op">(</span><span class="va">sps</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  83.10  96.12  97.14 109.14 124.08 125.10 170.16</span></span></code></pre>
<p>Note that it is also possible to retrieve specific spectra, e.g. for
a provided compound, or add compound annotations to the
<code>Spectra</code> object. Below we use the filter expression
<code>~ compound_id == "HMDB0000001"</code>to get only MS/MS spectra for
the specified compound. In addition we ask for the <code>"name"</code>
and <code>"inchikey"</code> of the compound.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">cmpdb</span>, filter <span class="op">=</span> <span class="op">~</span> <span class="va">compound_id</span> <span class="op">==</span> <span class="st">"HMDB0000001"</span>,</span>
<span>               columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/CompDb.html">tables</a></span><span class="op">(</span><span class="va">cmpdb</span><span class="op">)</span><span class="op">$</span><span class="va">msms_spectrum</span>, <span class="st">"name"</span>,</span>
<span>                           <span class="st">"inchikey"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sps</span></span></code></pre></div>
<pre><code><span><span class="co">## MSn data (Spectra) with 2 spectra in a MsBackendCompDb backend:</span></span>
<span><span class="co">##     msLevel precursorMz  polarity</span></span>
<span><span class="co">##   &lt;integer&gt;   &lt;numeric&gt; &lt;integer&gt;</span></span>
<span><span class="co">## 1        NA          NA         1</span></span>
<span><span class="co">## 2        NA          NA         1</span></span>
<span><span class="co">##  ... 32 more variables/columns.</span></span>
<span><span class="co">##  Use  'spectraVariables' to list all of them.</span></span>
<span><span class="co">##  data source: HMDB </span></span>
<span><span class="co">##  version: 4.0 </span></span>
<span><span class="co">##  organism: Hsapiens</span></span></code></pre>
<p>The available spectra variables:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">sps</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "msLevel"                 "rtime"                  </span></span>
<span><span class="co">##  [3] "acquisitionNum"          "scanIndex"              </span></span>
<span><span class="co">##  [5] "dataStorage"             "dataOrigin"             </span></span>
<span><span class="co">##  [7] "centroided"              "smoothed"               </span></span>
<span><span class="co">##  [9] "polarity"                "precScanNum"            </span></span>
<span><span class="co">## [11] "precursorMz"             "precursorIntensity"     </span></span>
<span><span class="co">## [13] "precursorCharge"         "collisionEnergy"        </span></span>
<span><span class="co">## [15] "isolationWindowLowerMz"  "isolationWindowTargetMz"</span></span>
<span><span class="co">## [17] "isolationWindowUpperMz"  "compound_id"            </span></span>
<span><span class="co">## [19] "name"                    "inchi"                  </span></span>
<span><span class="co">## [21] "inchikey"                "formula"                </span></span>
<span><span class="co">## [23] "exactmass"               "smiles"                 </span></span>
<span><span class="co">## [25] "original_spectrum_id"    "predicted"              </span></span>
<span><span class="co">## [27] "splash"                  "instrument_type"        </span></span>
<span><span class="co">## [29] "instrument"              "spectrum_id"            </span></span>
<span><span class="co">## [31] "msms_mz_range_min"       "msms_mz_range_max"      </span></span>
<span><span class="co">## [33] "synonym"</span></span></code></pre>
<p>The compound’s name and INCHI key have thus also been added as
spectra variables:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sps</span><span class="op">$</span><span class="va">inchikey</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "BRMWTNUJHUMWMS-LURJTMIESA-N" "BRMWTNUJHUMWMS-LURJTMIESA-N"</span></span></code></pre>
<p>To share or archive the such created <code>CompDb</code> database, we
can also create a dedicated R package containing the annotation. To
enable reproducible research, each <code>CompDb</code> package should
contain the version of the originating data source in its file name
(which is by default extracted from the metadata of the resource). Below
we create a <code>CompDb</code> package from the generated database
file. Required additional information we have to provide to the function
are the package creator/maintainer and its version.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/createCompDb.html">createCompDbPackage</a></span><span class="op">(</span></span>
<span>    <span class="va">db_file</span>, version <span class="op">=</span> <span class="st">"0.0.1"</span>, author <span class="op">=</span> <span class="st">"J Rainer"</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    maintainer <span class="op">=</span> <span class="st">"Johannes Rainer &lt;johannes.rainer@eurac.edu&gt;"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Creating package in /tmp/Rtmpyb4EDz/CompDb.Hsapiens.HMDB.4.0</span></span></code></pre>
<p>The function creates a folder (in our case in a temporary directory)
that can be build and installed with <code>R CMD build</code> and
<code>R CMD INSTALL</code>.</p>
<p>Special care should also be put on the license of the package that
can be passed with the <code>license</code> parameter. The license of
the package and how and if the package can be distributed will depend
also on the license of the originating resource.</p>
</div>
<div class="section level3">
<h3 id="sec:custom">
<code>CompDb</code> from custom data<a class="anchor" aria-label="anchor" href="#sec:custom"></a>
</h3>
<p>A <code>CompDb</code> database can also be created from custom,
manually defined annotations. To illustrate this we create below first a
<code>data.frame</code> with some arbitrary compound annotations.
According to the <code><a href="../reference/createCompDb.html">?createCompDb</a></code> help page, the data frame
needs to have columns <code>"compound_id"</code>, <code>"name"</code>,
<code>"inchi"</code>, <code>"inchikey"</code>, <code>"formula"</code>,
<code>"exactmass"</code>, <code>"synonyms"</code>. All columns except
<code>"compound_id"</code> can also contain missing values. It is also
possible to define additional columns. Below we thus create a
<code>data.frame</code> with some compound annotations as well as
additional columns. Note that all these annotations in this example are
for illustration purposes only and are by no means <em>real</em>. Also,
we don’t provide any information for columns <code>"inchi"</code>,
<code>"inchikey"</code> and <code>"formula"</code> setting all values
for these to <code>NA</code>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    compound_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CP_0001"</span>, <span class="st">"CP_0002"</span>, <span class="st">"CP_0003"</span>, <span class="st">"CP_0004"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span>,</span>
<span>    inchi <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>    inchikey <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>    formula <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>    exactmass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">123.4</span>, <span class="fl">234.5</span>, <span class="fl">345.6</span>, <span class="fl">456.7</span><span class="op">)</span>,</span>
<span>    compound_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G01"</span>, <span class="st">"G02"</span>, <span class="st">"G01"</span>, <span class="st">"G03"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next we add also <em>synonyms</em> for each compound. This columns
supports multiple values for each row.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmps</span><span class="op">$</span><span class="va">synonyms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"AA"</span>, <span class="st">"aaa"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"c"</span><span class="op">)</span>,</span>
<span>    <span class="op">(</span><span class="st">"d"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We also need to define the <em>metadata</em> for our database, which
we do with the <code><a href="../reference/createCompDb.html">make_metadata()</a></code> function. With this
information we can already create a first rudimentary
<code>CompDb</code> database that contains only compound annotations. We
thus create below our custom <code>CompDb</code> database in a temporary
directory. We also manually specify the name of our database with the
<code>dbFile</code> parameter - if not provided, the name of the
database will be constructed based on information from the
<code>metadata</code> parameter. In a real-case scenario,
<code>path</code> and <code>dbFile</code> should be changed to something
more meaningful.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCompDb.html">make_metadata</a></span><span class="op">(</span>source <span class="op">=</span> <span class="st">"manually defined"</span>, url <span class="op">=</span> <span class="st">""</span>,</span>
<span>                       source_version <span class="op">=</span> <span class="st">"1.0.0"</span>, source_date <span class="op">=</span> <span class="st">"2022-03-01"</span>,</span>
<span>                       organism <span class="op">=</span> <span class="cn">NA_character_</span><span class="op">)</span></span>
<span></span>
<span><span class="va">db_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCompDb.html">createCompDb</a></span><span class="op">(</span><span class="va">cmps</span>, metadata <span class="op">=</span> <span class="va">metad</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                        dbFile <span class="op">=</span> <span class="st">"CompDb.test.sqlite"</span><span class="op">)</span></span></code></pre></div>
<p>We can now load this toy database using the <code><a href="../reference/CompDb.html">CompDb()</a></code>
function providing the full path to the database file. Note that we load
the database in read-write mode by specifying
<code>flags = RSQLite::SQLITE_RW</code> - by default
<code><a href="../reference/CompDb.html">CompDb()</a></code> will load databases in read-only mode hence
ensuring that the data within the database can not be compromised. In
our case we would however like to add more information to this database
later and hence we load it in read-write mode.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompDb.html">CompDb</a></span><span class="op">(</span><span class="va">db_file</span>, flags <span class="op">=</span> <span class="fu">RSQLite</span><span class="fu">::</span><span class="va"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLITE_RW</a></span><span class="op">)</span></span>
<span><span class="va">cdb</span></span></code></pre></div>
<pre><code><span><span class="co">## class: CompDb </span></span>
<span><span class="co">##  data source: manually defined </span></span>
<span><span class="co">##  version: 1.0.0 </span></span>
<span><span class="co">##  organism: NA </span></span>
<span><span class="co">##  compound count: 4</span></span></code></pre>
<p>We can now retrieve annotations from the database with the
<code>compound()</code> function.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   name inchi inchikey formula exactmass compound_group</span></span>
<span><span class="co">## 1    A  &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;     123.4            G01</span></span>
<span><span class="co">## 2    B  &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;     234.5            G02</span></span>
<span><span class="co">## 3    C  &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;     345.6            G01</span></span>
<span><span class="co">## 4    D  &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;     456.7            G03</span></span></code></pre>
<p>Or also search and filter the annotations.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, filter <span class="op">=</span> <span class="op">~</span> <span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"A"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   name inchi inchikey formula exactmass compound_group</span></span>
<span><span class="co">## 1    A  &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;     123.4            G01</span></span>
<span><span class="co">## 2    B  &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;     234.5            G02</span></span></code></pre>
<p>Next we would like to add also MS2 spectra data to the database. This
could be either done directly in the <code><a href="../reference/createCompDb.html">createCompDb()</a></code> call
with parameter <code>msms_spectra</code>, or with the
<code><a href="../reference/CompDb.html">insertSpectra()</a></code> function that allows to add MS2 spectra
data to an existing <code>CompDb</code> which can be provided as a
<code>Spectra</code> object. We thus below manually create a
<code>Spectra</code> object with some arbitrary MS2 spectra -
alternatively, <code>Spectra</code> can be imported from a variety of
input sources, including MGF or MSP files using e.g. the <em><a href="https://bioconductor.org/packages/3.20/MsBackendMgf" class="external-link">MsBackendMgf</a></em>
or <em><a href="https://bioconductor.org/packages/3.20/MsBackendMsp" class="external-link">MsBackendMsp</a></em>
packages.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Define basic spectra variables</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span>msLevel <span class="op">=</span> <span class="fl">2L</span>, precursorMz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">124.4</span>, <span class="fl">124.4</span>, <span class="fl">235.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#' Add m/z and intensity information for each spectrum</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">20</span>, <span class="fl">59.1</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">30</span>, <span class="fl">59.1</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">206</span>, <span class="fl">321.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">13</span>, <span class="fl">45</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">43</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#' Create the Spectra object</span></span>
<span><span class="va">sps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<p>The <code>Spectra</code> object needs also to have a variable
(column) called <code>"compound_id"</code> which provides the
information with which existing compound in the database the spectrum is
associated.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">cdb</span>, <span class="st">"compound_id"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   compound_id</span></span>
<span><span class="co">## 1     CP_0001</span></span>
<span><span class="co">## 2     CP_0002</span></span>
<span><span class="co">## 3     CP_0003</span></span>
<span><span class="co">## 4     CP_0004</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sps</span><span class="op">$</span><span class="va">compound_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CP_0001"</span>, <span class="st">"CP_0001"</span>, <span class="st">"CP_0002"</span><span class="op">)</span></span></code></pre></div>
<p>We can also add additional information to the spectra, such as the
instrument.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sps</span><span class="op">$</span><span class="va">instrument</span> <span class="op">&lt;-</span> <span class="st">"AB Sciex TripleTOF 5600+"</span></span></code></pre></div>
<p>And we can now add these spectra to our existing toy
<code>CompDb</code>. Parameter <code>columns</code> allows to specify
which of the <em>spectra variables</em> should be stored into the
database.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompDb.html">insertSpectra</a></span><span class="op">(</span><span class="va">cdb</span>, spectra <span class="op">=</span> <span class="va">sps</span>,</span>
<span>                     columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compound_id"</span>, <span class="st">"msLevel"</span>,</span>
<span>                                 <span class="st">"precursorMz"</span>, <span class="st">"instrument"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cdb</span></span></code></pre></div>
<pre><code><span><span class="co">## class: CompDb </span></span>
<span><span class="co">##  data source: manually defined </span></span>
<span><span class="co">##  version: 1.0.0 </span></span>
<span><span class="co">##  organism: NA </span></span>
<span><span class="co">##  compound count: 4 </span></span>
<span><span class="co">##  MS/MS spectra count: 3</span></span></code></pre>
<p>We have thus now a <code>CompDb</code> database with compound
annotations and 3 MS2 spectra. We could for example also retrieve the
MS2 spectra for the compound with the name <em>A</em> from the database
with:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">cdb</span>, filter <span class="op">=</span> <span class="op">~</span> <span class="va">name</span> <span class="op">==</span> <span class="st">"A"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## MSn data (Spectra) with 2 spectra in a MsBackendCompDb backend:</span></span>
<span><span class="co">##     msLevel precursorMz  polarity</span></span>
<span><span class="co">##   &lt;integer&gt;   &lt;numeric&gt; &lt;integer&gt;</span></span>
<span><span class="co">## 1         2       124.4        NA</span></span>
<span><span class="co">## 2         2       124.4        NA</span></span>
<span><span class="co">##  ... 31 more variables/columns.</span></span>
<span><span class="co">##  Use  'spectraVariables' to list all of them.</span></span>
<span><span class="co">##  data source: manually defined </span></span>
<span><span class="co">##  version: 1.0.0 </span></span>
<span><span class="co">##  organism: NA</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="compdb-from-mona-data">
<code>CompDb</code> from MoNA data<a class="anchor" aria-label="anchor" href="#compdb-from-mona-data"></a>
</h3>
<p>MoNa (Massbank of North America) provides a large SDF file with all
spectra which can be used to create a <code>CompDb</code> object with
compound information and MS/MS spectra. Note however that MoNa is
organized by spectra and the annotation of the compounds is not
consistent and normalized. Spectra from the same compound can have their
own compound identified and data that e.g. can differ in their chemical
formula, precision of their exact mass or other fields.</p>
<p>Similar to the example above, compound annotations can be imported
with the <code><a href="../reference/compound_tbl_sdf.html">compound_tbl_sdf()</a></code> function while spectrum data
can be imported with <code><a href="../reference/msms_spectra_mona.html">msms_spectra_mona()</a></code>. In the example
below we use however the <code><a href="../reference/import_mona_sdf.html">import_mona_sdf()</a></code> that wraps both
functions to reads both compound and spectrum data from a SDF file
without having to import the file twice. As an example we use a small
subset from a MoNa SDF file that contains only 7 spectra.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mona_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sdf/MoNa_export-All_Spectra_sub.sdf.gz"</span>,</span>
<span>                        package <span class="op">=</span> <span class="st">"CompoundDb"</span><span class="op">)</span></span>
<span><span class="va">mona_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_mona_sdf.html">import_mona_sdf</a></span><span class="op">(</span><span class="va">mona_sub</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: MoNa data can currently not be normalized and the compound table</span></span>
<span><span class="co">## contains thus highly redundant data.</span></span></code></pre>
<p>As a result we get a <code>list</code> with a data.frame each for
compound and spectrum information. These can be passed along to the
<code><a href="../reference/createCompDb.html">createCompDb()</a></code> function to create the database (see
below).</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCompDb.html">make_metadata</a></span><span class="op">(</span>source <span class="op">=</span> <span class="st">"MoNa"</span>,</span>
<span>                       url <span class="op">=</span> <span class="st">"http://mona.fiehnlab.ucdavis.edu/"</span>,</span>
<span>                       source_version <span class="op">=</span> <span class="st">"2018.11"</span>, source_date <span class="op">=</span> <span class="st">"2018-11"</span>,</span>
<span>                       organism <span class="op">=</span> <span class="st">"Unspecified"</span><span class="op">)</span></span>
<span><span class="va">mona_db_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCompDb.html">createCompDb</a></span><span class="op">(</span><span class="va">mona_data</span><span class="op">$</span><span class="va">compound</span>, metadata <span class="op">=</span> <span class="va">metad</span>,</span>
<span>                             msms_spectra <span class="op">=</span> <span class="va">mona_data</span><span class="op">$</span><span class="va">msms_spectrum</span>,</span>
<span>                             path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can now load and use this database, e.g. by extracting all
compounds as shown below.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mona</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompDb.html">CompDb</a></span><span class="op">(</span><span class="va">mona_db_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">mona</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   name</span></span>
<span><span class="co">## 1 Sulfachlorpyridazine</span></span>
<span><span class="co">## 2         Sulfaclozine</span></span>
<span><span class="co">## 3        Sulfadimidine</span></span>
<span><span class="co">## 4       Sulfamethazine</span></span>
<span><span class="co">## 5       Sulfamethazine</span></span>
<span><span class="co">##                                                                                                      inchi</span></span>
<span><span class="co">## 1             InChI=1S/C10H9ClN4O2S/c11-9-5-6-10(14-13-9)15-18(16,17)8-3-1-7(12)2-4-8/h1-6H,12H2,(H,14,15)</span></span>
<span><span class="co">## 2             InChI=1S/C10H9ClN4O2S/c11-9-5-13-6-10(14-9)15-18(16,17)8-3-1-7(12)2-4-8/h1-6H,12H2,(H,14,15)</span></span>
<span><span class="co">## 3 InChI=1S/C12H14N4O2S/c1-8-7-9(2)15-12(14-8)16-19(17,18)11-5-3-10(13)4-6-11/h3-7H,13H2,1-2H3,(H,14,15,16)</span></span>
<span><span class="co">## 4 InChI=1S/C12H14N4O2S/c1-8-7-9(2)15-12(14-8)16-19(17,18)11-5-3-10(13)4-6-11/h3-7H,13H2,1-2H3,(H,14,15,16)</span></span>
<span><span class="co">## 5 InChI=1S/C12H14N4O2S/c1-8-7-9(2)15-12(14-8)16-19(17,18)11-5-3-10(13)4-6-11/h3-7H,13H2,1-2H3,(H,14,15,16)</span></span>
<span><span class="co">##                      inchikey      formula exactmass smiles</span></span>
<span><span class="co">## 1 XOXHILFPRYWFOD-UHFFFAOYSA-N C10H9ClN4O2S  284.0135   &lt;NA&gt;</span></span>
<span><span class="co">## 2 QKLPUVXBJHRFQZ-UHFFFAOYSA-N C10H9ClN4O2S  284.0135   &lt;NA&gt;</span></span>
<span><span class="co">## 3 ASWVTGNCAZCNNR-UHFFFAOYSA-N  C12H14N4O2S  278.0837   &lt;NA&gt;</span></span>
<span><span class="co">## 4 ASWVTGNCAZCNNR-UHFFFAOYSA-N  C12H14N4O2S  278.0837   &lt;NA&gt;</span></span>
<span><span class="co">## 5 ASWVTGNCAZCNNR-UHFFFAOYSA-N  C12H14N4O2S  278.0837   &lt;NA&gt;</span></span></code></pre>
<p>As stated in the introduction of this section the
<code>compound</code> information contains redundant information and the
table has essentially one row per spectrum. Feedback on how to reduce
the redundancy in the ms_compound table is highly appreciated.</p>
</div>
<div class="section level3">
<h3 id="sec:fill">
<code>CompDb</code> by sequentially filling with data<a class="anchor" aria-label="anchor" href="#sec:fill"></a>
</h3>
<p>As an alternative to creating a full database from an existing
resource it is also possible to create an empty <code>CompDb</code>
database and <em>sequentially</em> filling it with data. This could for
example be used to create a laboratory specific annotation library with
compound, ion and fragment spectra of pure standards measured on a
certain LC-MS setup. Below we create an empty <code>CompDb</code>
database providing the file name of the database. In the example we
store the database to a temporary file but in a real use case a
meaningful file name and file path should be used instead.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dbfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">mydb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCompDb.html">emptyCompDb</a></span><span class="op">(</span><span class="va">dbfile</span><span class="op">)</span></span>
<span><span class="va">mydb</span></span></code></pre></div>
<pre><code><span><span class="co">## class: CompDb </span></span>
<span><span class="co">##  data source: NA </span></span>
<span><span class="co">##  version: NA </span></span>
<span><span class="co">##  organism: NA </span></span>
<span><span class="co">##  compound count: 0</span></span></code></pre>
<p>We next define some first compound annotation we want to add to the
database. For compound annotations, fields <code>"compound_id"</code>
(an arbitrary ID of the compound), <code>"name"</code> (the compound
name), <code>"inchi"</code>, <code>"inchikey"</code>,
<code>"formula"</code> (the chemical formula) and
<code>"exactmass"</code> (the monoisotopic mass) are expected, but,
except of <code>"compound_id"</code>, they can also contain missing
values or be completely omitted. Below we define a
<code>data.frame</code> with annotations for some compounds and add this
annotation to the database using the <code><a href="../reference/CompDb.html">insertCompound()</a></code>
function.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>compound_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span><span class="op">)</span>,</span>
<span>                  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Caffeine"</span>, <span class="st">"Glucose"</span><span class="op">)</span>,</span>
<span>                  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C8H10N4O2"</span>, <span class="st">"C6H12O6"</span><span class="op">)</span>,</span>
<span>                  exactmass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">194.080375584</span>, <span class="fl">180.063388116</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mydb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompDb.html">insertCompound</a></span><span class="op">(</span><span class="va">mydb</span>, <span class="va">cmp</span><span class="op">)</span></span>
<span><span class="va">mydb</span></span></code></pre></div>
<pre><code><span><span class="co">## class: CompDb </span></span>
<span><span class="co">##  data source: NA </span></span>
<span><span class="co">##  version: NA </span></span>
<span><span class="co">##  organism: NA </span></span>
<span><span class="co">##  compound count: 2</span></span></code></pre>
<p>We next add fragment spectra for the compounds. These could for
example represent MS2 spectra measured for the pure standard of the
compound and could be extracted for example from <em><a href="https://bioconductor.org/packages/3.20/xcms" class="external-link">xcms</a></em> result
objects or other sources. Below we load some fragment spectra for
caffeine from an MGF file distributed with this package. We use the
<em><a href="https://bioconductor.org/packages/3.20/MsBackendMgf" class="external-link">MsBackendMgf</a></em>
package to import that data into a <code>Spectra</code> object.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsBackendMgf" class="external-link">MsBackendMgf</a></span><span class="op">)</span></span>
<span><span class="va">caf_ms2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"mgf"</span>, <span class="st">"caffeine.mgf"</span>, package <span class="op">=</span> <span class="st">"CompoundDb"</span><span class="op">)</span>,</span>
<span>                   source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MsBackendMgf/man/MsBackendMgf.html" class="external-link">MsBackendMgf</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">caf_ms2</span></span></code></pre></div>
<pre><code><span><span class="co">## MSn data (Spectra) with 2 spectra in a MsBackendMgf backend:</span></span>
<span><span class="co">##     msLevel     rtime scanIndex</span></span>
<span><span class="co">##   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span></span>
<span><span class="co">## 1         2        NA        NA</span></span>
<span><span class="co">## 2         2        NA        NA</span></span>
<span><span class="co">##  ... 25 more variables/columns.</span></span></code></pre>
<p>We can evaluate what spectra variables are available in the imported
data.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">caf_ms2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "msLevel"                 "rtime"                  </span></span>
<span><span class="co">##  [3] "acquisitionNum"          "scanIndex"              </span></span>
<span><span class="co">##  [5] "dataStorage"             "dataOrigin"             </span></span>
<span><span class="co">##  [7] "centroided"              "smoothed"               </span></span>
<span><span class="co">##  [9] "polarity"                "precScanNum"            </span></span>
<span><span class="co">## [11] "precursorMz"             "precursorIntensity"     </span></span>
<span><span class="co">## [13] "precursorCharge"         "collisionEnergy"        </span></span>
<span><span class="co">## [15] "isolationWindowLowerMz"  "isolationWindowTargetMz"</span></span>
<span><span class="co">## [17] "isolationWindowUpperMz"  "TITLE"                  </span></span>
<span><span class="co">## [19] "original_spectrum_id"    "compound_id"            </span></span>
<span><span class="co">## [21] "collision_energy"        "predicted"              </span></span>
<span><span class="co">## [23] "splash"                  "spectrum_id"            </span></span>
<span><span class="co">## [25] "msms_mz_range_min"       "msms_mz_range_max"</span></span></code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">caf_ms2</span><span class="op">$</span><span class="va">rtime</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA</span></span></code></pre>
<p>There are many variables available, but most of them, like for
example the retention time, or not defined as this information was not
provided in the MGF file. In order to associate these fragment spectra
to the caffeine compound we just added to the database, we need to
assign them the ID of the compound (in our case <code>"1"</code>).</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">caf_ms2</span><span class="op">$</span><span class="va">compound_id</span> <span class="op">&lt;-</span> <span class="st">"1"</span></span></code></pre></div>
<p>We can then add the spectra to the database using the
<code><a href="../reference/CompDb.html">insertSpectra()</a></code> function. With parameter
<code>columns</code> we specify which of the spectra variables we
actually want to store in the database.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompDb.html">insertSpectra</a></span><span class="op">(</span><span class="va">mydb</span>, <span class="va">caf_ms2</span>,</span>
<span>                      columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compound_id"</span>, <span class="st">"msLevel"</span>, <span class="st">"splash"</span>,</span>
<span>                                  <span class="st">"precursorMz"</span>, <span class="st">"collisionEnergy"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mydb</span></span></code></pre></div>
<pre><code><span><span class="co">## class: CompDb </span></span>
<span><span class="co">##  data source: NA </span></span>
<span><span class="co">##  version: NA </span></span>
<span><span class="co">##  organism: NA </span></span>
<span><span class="co">##  compound count: 2 </span></span>
<span><span class="co">##  MS/MS spectra count: 2</span></span></code></pre>
<p>We thus have now 2 compounds in the database and 2 fragment
spectra:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">mydb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       name inchi inchikey   formula exactmass</span></span>
<span><span class="co">## 1 Caffeine  &lt;NA&gt;     &lt;NA&gt; C8H10N4O2  194.0804</span></span>
<span><span class="co">## 2  Glucose  &lt;NA&gt;     &lt;NA&gt;   C6H12O6  180.0634</span></span></code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">mydb</span><span class="op">)</span></span>
<span><span class="va">sps</span><span class="op">$</span><span class="va">name</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Caffeine" "Caffeine"</span></span></code></pre>
<p>With <code>insertCommpound()</code> and <code><a href="../reference/CompDb.html">insertSpectra()</a></code>
further compounds and fragment spectra could be added to the database.
Note that both functions support also to add additional columns
(<em>fields</em> or <em>variables</em>) to the database. As an example
we define below a compound with an arbitrary additional column and add
this to the database using parameter <code>addColumns = TRUE</code>.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>compound_id <span class="op">=</span> <span class="st">"3"</span>, name <span class="op">=</span> <span class="st">"X003"</span>,</span>
<span>                   formula <span class="op">=</span> <span class="st">"C5H2P3O"</span>, extra_field <span class="op">=</span> <span class="st">"artificial compound"</span><span class="op">)</span></span>
<span><span class="va">mydb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompDb.html">insertCompound</a></span><span class="op">(</span><span class="va">mydb</span>, <span class="va">cmps</span>, addColumns <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">mydb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       name inchi inchikey   formula exactmass         extra_field</span></span>
<span><span class="co">## 1 Caffeine  &lt;NA&gt;     &lt;NA&gt; C8H10N4O2  194.0804                &lt;NA&gt;</span></span>
<span><span class="co">## 2  Glucose  &lt;NA&gt;     &lt;NA&gt;   C6H12O6  180.0634                &lt;NA&gt;</span></span>
<span><span class="co">## 3     X003  &lt;NA&gt;     &lt;NA&gt;   C5H2P3O        NA artificial compound</span></span></code></pre>
<p>The additional column is now available in the database. Existing
entries in a <code>CompDb</code> can also be deleted using the
<code><a href="../reference/CompDb.html">deleteCompound()</a></code> or <code><a href="../reference/CompDb.html">deleteSpectra()</a></code> functions.
Both require as additional input the IDs of the compound(s) (or spectra)
to delete. Below we extract the IDs and names of the compounds from our
database.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">mydb</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compound_id"</span>, <span class="st">"name"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   compound_id     name</span></span>
<span><span class="co">## 1           1 Caffeine</span></span>
<span><span class="co">## 2           2  Glucose</span></span>
<span><span class="co">## 3           3     X003</span></span></code></pre>
<p>We can now delete the compound <code>"X003"</code> with
<code><a href="../reference/CompDb.html">deleteCompound()</a></code> and the ID of this compound.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompDb.html">deleteCompound</a></span><span class="op">(</span><span class="va">mydb</span>, ids <span class="op">=</span> <span class="st">"3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">mydb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       name inchi inchikey   formula exactmass extra_field</span></span>
<span><span class="co">## 1 Caffeine  &lt;NA&gt;     &lt;NA&gt; C8H10N4O2  194.0804        &lt;NA&gt;</span></span>
<span><span class="co">## 2  Glucose  &lt;NA&gt;     &lt;NA&gt;   C6H12O6  180.0634        &lt;NA&gt;</span></span></code></pre>
<p>Note that deleting a compound with associated spectra (or ions) will
result in an error, thus it would not be possible to delete caffeine
from the database, because it contains also MS2 spectra for that
compound. Using parameter <code>recursive = TRUE</code> in the
<code><a href="../reference/CompDb.html">deleteCompound()</a></code> call would however allow to delete the
compound <strong>and all</strong> associated spectra (and/or ions) along
with it. Below we delete thus caffeine and the associated MS2 spectra
which leaves us a <code>CompDb</code> with a single compound and no more
MS2 spectra.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompDb.html">deleteCompound</a></span><span class="op">(</span><span class="va">mydb</span>, ids <span class="op">=</span> <span class="st">"1"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compounds</a></span><span class="op">(</span><span class="va">mydb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      name inchi inchikey formula exactmass extra_field</span></span>
<span><span class="co">## 1 Glucose  &lt;NA&gt;     &lt;NA&gt; C6H12O6  180.0634        &lt;NA&gt;</span></span></code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">mydb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## MSn data (Spectra) with 0 spectra in a MsBackendCompDb backend:</span></span></code></pre>
<p>Note that these functions can also be used to add or remove
annotations to/from any <code>CompDb</code> database, as long as the
database is <em>writeable</em> (i.e. the database is loaded by
specifying <code>flags = RSQLite::SQLITE_RW</code> as additional
parameter to the <code>CompDb</code> call to load the database).</p>
</div>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<pre><code><span><span class="co">## R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] MsBackendMgf_1.13.0     Spectra_1.15.4          ProtGenerics_1.37.0    </span></span>
<span><span class="co">## [4] BiocParallel_1.39.0     CompoundDb_1.9.3        S4Vectors_0.43.1       </span></span>
<span><span class="co">## [7] BiocGenerics_0.51.0     AnnotationFilter_1.29.0 BiocStyle_2.33.1       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] tidyselect_1.2.1        dplyr_1.1.4             blob_1.2.4             </span></span>
<span><span class="co">##  [4] bitops_1.0-7            fastmap_1.2.0           lazyeval_0.2.2         </span></span>
<span><span class="co">##  [7] RCurl_1.98-1.16         digest_0.6.36           lifecycle_1.0.4        </span></span>
<span><span class="co">## [10] cluster_2.1.6           rsvg_2.6.0              RSQLite_2.3.7          </span></span>
<span><span class="co">## [13] magrittr_2.0.3          compiler_4.4.1          rlang_1.1.4            </span></span>
<span><span class="co">## [16] sass_0.4.9              tools_4.4.1             utf8_1.2.4             </span></span>
<span><span class="co">## [19] yaml_2.3.9              knitr_1.48              htmlwidgets_1.6.4      </span></span>
<span><span class="co">## [22] bit_4.0.5               xml2_1.3.6              desc_1.4.3             </span></span>
<span><span class="co">## [25] grid_4.4.1              fansi_1.0.6             colorspace_2.1-0       </span></span>
<span><span class="co">## [28] ggplot2_3.5.1           scales_1.3.0            MASS_7.3-61            </span></span>
<span><span class="co">## [31] cli_3.6.3               rmarkdown_2.27          ragg_1.3.2             </span></span>
<span><span class="co">## [34] generics_0.1.3          httr_1.4.7              rjson_0.2.21           </span></span>
<span><span class="co">## [37] DBI_1.2.3               cachem_1.1.0            zlibbioc_1.51.1        </span></span>
<span><span class="co">## [40] parallel_4.4.1          BiocManager_1.30.23     XVector_0.45.0         </span></span>
<span><span class="co">## [43] base64enc_0.1-3         vctrs_0.6.5             jsonlite_1.8.8         </span></span>
<span><span class="co">## [46] bookdown_0.40           IRanges_2.39.1          bit64_4.0.5            </span></span>
<span><span class="co">## [49] clue_0.3-65             systemfonts_1.1.0       jquerylib_0.1.4        </span></span>
<span><span class="co">## [52] glue_1.7.0              pkgdown_2.1.0.9000      codetools_0.2-20       </span></span>
<span><span class="co">## [55] DT_0.33                 gtable_0.3.5            GenomeInfoDb_1.41.1    </span></span>
<span><span class="co">## [58] GenomicRanges_1.57.1    UCSC.utils_1.1.0        munsell_0.5.1          </span></span>
<span><span class="co">## [61] tibble_3.2.1            pillar_1.9.0            htmltools_0.5.8.1      </span></span>
<span><span class="co">## [64] GenomeInfoDbData_1.2.12 R6_2.5.1                dbplyr_2.5.0           </span></span>
<span><span class="co">## [67] textshaping_0.4.0       evaluate_0.24.0         Biobase_2.65.0         </span></span>
<span><span class="co">## [70] png_0.1-8               memoise_2.0.1           bslib_0.7.0            </span></span>
<span><span class="co">## [73] MetaboCoreUtils_1.13.0  Rcpp_1.0.12             gridExtra_2.3          </span></span>
<span><span class="co">## [76] ChemmineR_3.57.0        xfun_0.45               fs_1.6.4               </span></span>
<span><span class="co">## [79] MsCoreUtils_1.17.0      pkgconfig_2.0.3</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jan Stanstrup, Johannes Rainer, Roger Gine, Andrea Vicini.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
